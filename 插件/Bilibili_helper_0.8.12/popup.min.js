/*! bilibili-helper-master 2016-07-17 */
function adModeFunction(a){chrome.tabs.getSelected(null,function(b){chrome.tabs.sendMessage(b.id,{command:a,css:bkg_page.ad_mode},function(a){"undefined"!=typeof a&&(0==a.mode?$("#ad_mode").html(chrome.i18n.getMessage("adModeOff")):1==a.mode&&$("#ad_mode").html(chrome.i18n.getMessage("adModeOn")))})})}function getDynamic(){bkg_page.chrome.cookies.get({url:"http://interface.bilibili.com/",name:"DedeUserID"},function(a){null===a?$("#go_dynamic").html(chrome.i18n.getMessage("goDynamic")+chrome.i18n.getMessage("notLogged")):bkg_page.getOption("updates")>0?$("#go_dynamic").html(chrome.i18n.getMessage("goDynamic")+'<span class="red">'+chrome.i18n.getMessage("nNewUpdate").replace("%n",bkg_page.getOption("updates"))+"</span>"):$("#go_dynamic").html(chrome.i18n.getMessage("goDynamic"))})}var bkg_page=chrome.extension.getBackgroundPage();$(document).ready(function(){chrome.tabs.getSelected(null,function(a){"www.bilibili.com"==a.url.match(/:\/\/(.[^\/]+)/)[1]||"space.bilibili.com"==a.url.match(/:\/\/(.[^\/]+)/)[1]?$("#go_bili").hide():"space.bilibili.com"==a.url.match(/:\/\/(.[^\/]+)/)[1]||"member.bilibili.com"==a.url.match(/:\/\/(.[^\/]+)/)[1]?$("#go_bili, #ad_mode").hide():$("#css_switch,#ad_mode").hide()}),$("#go_bili").html(chrome.i18n.getMessage("goBili")),$("#ad_mode").html(chrome.i18n.getMessage("adModeOff")),$("#go_video").html(chrome.i18n.getMessage("goVideo")),$("#go_option").html(chrome.i18n.getMessage("goOption")),$("#go_favorite").html(chrome.i18n.getMessage("goFavorite")),getDynamic(),adModeFunction("checkAdMode"),setTimeout(function(){$("button").blur(),$("#video_id").focus()},100),$("#go_bili").click(function(){return chrome.tabs.create({url:"old"==bkg_page.getOption("indexversion")?"http://www.bilibili.com/index_old.html":"http://www.bilibili.com/"}),!1}),$("#go_dynamic").click(function(){return bkg_page.chrome.browserAction.setBadgeText({text:""}),bkg_page.setOption("updates",0),chrome.tabs.create({url:"http://www.bilibili.com/account/dynamic"}),!1}),$("#go_favorite").click(function(){return chrome.tabs.create({url:"http://member.bilibili.com/#favorite_manage"}),!1}),$("#go_option").click(function(){return chrome.tabs.create({url:chrome.extension.getURL("options.html")}),!1}),$("#ad_mode").click(function(){adModeFunction("adMode")}),$("#video_id").keyup(function(a){13==a.keyCode&&$("#go_video").click()}),$("#go_video").click(function(){var a=$("#video_id").val().toLowerCase();return/av[0-9]+/g.test(a)?chrome.tabs.create({url:"http://www.bilibili.com/video/"+a}):/[0-9]+/g.test(a)?chrome.tabs.create({url:"http://www.bilibili.com/video/av"+a}):$("#video_id").val("").focus(),!1})});