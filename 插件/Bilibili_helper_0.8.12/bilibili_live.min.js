/*! bilibili-helper-master 2016-07-17 */
!function(){if("live.bilibili.com"==location.hostname){var Live={};Live.addScriptByFile=function(a){var b=document.createElement("script");b.src=chrome.extension.getURL(a),document.body.appendChild(b)},Live.addScriptByText=function(a){var b=document.createElement("script");b.innerHTML=a,document.body.appendChild(b)},Live.addScriptByText('(function(){var a=function(f,d,c){if(!window.localStorage||!f){return}var e=window.localStorage;if(!e[f]){e[f]=JSON.stringify({})}var b=JSON.parse(e[f]);if(c==undefined){e[f]=typeof d=="string"?d.trim():JSON.stringify(d)}else{b[d]=typeof c=="string"?c.trim():JSON.stringify(c);e[f]=JSON.stringify(b)}};a("helper_live_roomId",ROOMURL,ROOMID);a("helper_live_rnd",ROOMURL,DANMU_RND)})();'),Live.set=function(a,b,c){if(window.localStorage&&a){var d=window.localStorage;d[a]||(d[a]=JSON.stringify({}));var e=JSON.parse(d[a]);void 0==c?d[a]="string"==typeof b?b.trim():JSON.stringify(b):(e[b]="string"==typeof c?c.trim():JSON.stringify(c),d[a]=JSON.stringify(e))}},Live.get=function(a,b,c){if(window.localStorage&&a){if(!window.localStorage[a]){var d=void 0==c?{}:c;void 0!=b&&void 0!=c&&(d[b]=c),window.localStorage[a]=JSON.stringify(d)}var e=JSON.parse(window.localStorage[a]);return void 0==b?e:("true"!=e[b]&&"false"!=e[b]||(e[b]=JSON.parse(e[b])),e[b])}},Live.del=function(a,b){if(window.localStorage&&void 0!=a&&void 0!=window.localStorage[a]){if(void 0==b)return void window.localStorage.removeItem(a);var c=JSON.parse(window.localStorage[a]);delete c[b],window.localStorage[a]=JSON.stringify(c)}},Live.getRoomHTML=function(a){return $.get("http://live.bilibili.com/"+a).promise()},Live.getRoomIdByUrl=function(a,b){Live.getRoomHTML(a).done(function(c){var d=new RegExp("var ROOMID = ([\\d]+)"),e=d.exec(c)[1];Live.set("helper_live_roomId",a,e),"function"==typeof b&&b(e)})},Live.getUser=function(){return $.getJSON("/user/getuserinfo").promise()},Live.each=function(a,b){if(b)if(a instanceof Array)for(var c=0,d=a.length;c<d&&0!=b.call(a[c],c);c++);else if("object"==typeof a){var e=null;for(e in a)if(0==b.call(a[e],e))break}},Live.initUserInfo=function(a){return Live.getUser().done(function(b){return"REPONSE_OK"==b.code?(b=b.data,Live.set("helper_userInfo","username",b.uname),Live.set("helper_userInfo","userLevel",b.user_level),Live.set("helper_userInfo","silver",b.silver),Live.set("helper_userInfo","gold",b.gold),Live.set("helper_userInfo","face",b.face),Live.set("helper_userInfo","vip",b.vip),Live.set("helper_userInfo","login",!0),a&&"function"==typeof a&&a(b),!0):void(b.code==-101&&Live.del("helper_userInfo"))})},Live.clearLocalStorage=function(){Live.del("helper_live_bet",Live.getRoomId()),Live.del("helper_live_check",Live.getRoomId()),Live.del("helper_live_number",Live.getRoomId()),Live.del("helper_live_rate",Live.getRoomId()),Live.del("helper_live_which",Live.getRoomId()),Live.del("helper_doSign_today",Live.getRoomId()),Live.del("helper_doSign_date",Live.getRoomId()),Live.del("helper_userInfo",Live.getRoomId()),Live.del("noTreasure",Live.get("helper_userInfo","username"))},Live.getRoomId=function(){return Live.get("helper_live_roomId",location.pathname.substr(1))},Live.getRoomInfo=function(){return $.getJSON("/live/getInfo?roomid="+Live.getRoomId()).promise()},Live.numFormat=function(a){var b=a;return a>=1e4&&(b=(a/1e4).toFixed(1)+"万"),b},Live.rgb2hex=function(a){function b(a,b){for(var c=a.toString(16);c.length<b;)c="0"+c;return c}if("#"==a.charAt(0))return a;var c=a.split(/\D+/),d=65536*Number(c[1])+256*Number(c[2])+Number(c[3]);return"#"+b(d,6)},Live.getDomType=function(a){var b=Object.prototype.toString.call(a),c=/HTML.*.Element/;return"[object Object]"===b&&a.jquery?"jQuery Object":"[object Object]"===b?"Object":"[object Number]"===b?"Number":"[object String]"===b?"String":"[object Array]"===b?"Array":"[object Boolean]"===b?"Boolean":"[object Function]"===b?"Function":"[object Null]"===b?"null":"[object Undefined]"===b?"undefined":b.match(c)?"HTML Element":"[object HTMLCollection]"===b?"HTML Elements Collection":null},Live.randomEmoji={list:{happy:["(｀･ω･´)","=‿=✧","●ω●","(/ ▽ \\)","(=・ω・=)","(●'◡'●)ﾉ♥","<(▰˘◡˘▰)>","(⁄ ⁄•⁄ω⁄•⁄ ⁄)","(ง,,• ᴗ •,,)ง ✧"],shock:[",,Ծ‸Ծ,,","(｀･д･´)","Σ( ° △ °|||)︴","┌( ಠ_ಠ)┘","(ﾟДﾟ≡ﾟдﾟ)!?"],sad:["∑(っ °Д °;)っ","＞︿＜","＞△＜","●︿●","(´；ω；`)"],helpless:["◐▽◑","ʅ（´◔౪◔）ʃ","_(:3 」∠)_","_(┐「ε:)_","(/・ω・＼)","(°▽°)ﾉ"]},happy:function(){return Live.randomEmoji.list.happy[Math.floor(Math.random()*Live.randomEmoji.list.happy.length)]},sad:function(){return Live.randomEmoji.list.sad[Math.floor(Math.random()*Live.randomEmoji.list.sad.length)]},shock:function(){return Live.randomEmoji.list.shock[Math.floor(Math.random()*Live.randomEmoji.list.shock.length)]},helpless:function(){return Live.randomEmoji.list.helpless[Math.floor(Math.random()*Live.randomEmoji.list.helpless.length)]}},Live.console={option:{display:{danmu:!1,tv_end:!1,gift:!1,system:!1,tv:!1,sys_gift:!1}},watcher:function(a){console.log("%c监控:"+a,"color:#FFFFFF;background-color:#4fc1e9;padding:5px;border-radius:7px;line-height:30px;")},info:function(a,b){if("danmu"==a&&Live.console.option.display.danmu){var c=b.info[1],d=b.info[2][0],e=b.info[2][1],f=b.info[4][0],g=b.info[4][1];console.log("%c(UL:"+f+")"+d+"-"+e+":"+c+" 排名:"+g,"color:#FFFFFF;background-color:#646c7a;padding:5px;border-radius:7px;line-height:30px;")}else if("system"==a&&Live.console.option.display.system){var h=b.msg,i=b.url;console.log("%c系统通告:"+h+" 地址:"+i,"color:#FFFFFF;background-color:#e74e8f;padding:5px;border-radius:7px;line-height:30px;")}else if("tv_end"==a&&Live.console.option.display.tv_end)console.log(b);else if("gift"==a&&Live.console.option.display.gift){var j=b.data.giftName,k=b.data.num,l=b.data.uname;console.log("%c喂食:"+j+" x"+k+" 用户名:"+l,"color:#FFFFFF;background-color:#ff8e29;padding:5px;border-radius:7px;line-height:30px;")}else"sys_gift"==a&&Live.console.option.display.sys_gift&&console.log("%c系统通告:"+b.tips+" 地址:"+b.url,"color:#FFFFFF;background-color:#e74e8f;padding:5px;border-radius:7px;line-height:30px;")}},Live.sendMsg=function(b,c,d){function e(a){var b=a.offsetLeft;return null!==a.offsetParent?b+=e(a.offsetParent):void 0,b}function f(a){var b=a.offsetTop;return null!==a.offsetParent?b+=f(a.offsetParent):void 0,b}if(n=c||"info","success"===n||"caution"===n||"error"===n||"info"===n){var g=document.createDocumentFragment(),h=document.createElement("div");h.innerHTML="<i class='toast-icon info'></i><span class='toast-text'>"+d+Live.randomEmoji.helpless()+"</span>",h.className="live-toast "+n;var i=null;switch(Live.getDomType(b)){case"HTML Element":i=b;break;case"jQuery Object":i=b[0];break;default:throw new Error(a.consoleText.error+"在使用 Live Toast 时请传入正确的原生 Dom 对象或节点的 jQuery 对象.")}var j={width:$(i).width(),height:$(i).height()},k=e(i),l=f(i);$(h).css({left:k+j.width});var m=0;m=document.body.scrollTop,$(h).css({top:l+j.height}),setTimeout(function(){$(h).addClass("out"),setTimeout(function(){$(h).remove(),g=h=i=j=k=l=m=null},400)},2e3),g.appendChild(h),document.body.appendChild(g);var o=$(window).width(),p=h.offsetWidth,q=h.offsetLeft;0>o-p-q&&$(h).css({left:o-p-10}),o=p=q=null}},Live.doSign={getSignInfo:function(){return $.getJSON("/sign/GetSignInfo").promise()},init:function(){Live.doSign.getSignInfo().done(function(a){if(0==a.code&&0==a.data.status)Live.doSign.sign(),setInterval(Live.doSign.sign,6e4);else if(0==a.code&&1==a.data.status){var b=Live.get("helper_userInfo","username");Live.set("helper_doSign_today",b,!0),Live.set("helper_doSign_date",b,(new Date).getDate())}})},sign:function(){var date=(new Date).getDate(),username=Live.get("helper_userInfo","username");Live.get("helper_doSign_today",username)&&Live.get("helper_doSign_date",username)==date||$.get("/sign/doSign",function(data){var e=JSON.parse(data),msg=void 0;if(0==e.code){msg=new Notification("签到成功",{body:"您获得了"+e.data.text,icon:"//static.hdslb.com/live-static/images/7.png"}),Live.set("helper_doSign_today",username,!0),Live.set("helper_doSign_date",username,date),setTimeout(function(){msg.close()},1e4);var spans=$(".body-container").find(".room-left-sidebar .sign-and-mission .sign-up-btn .dp-inline-block span");$(spans[0]).hide(),$(spans[1]).show()}else e.code==-500?(msg=new Notification(eval("'"+e.msg+"'"),{body:"不能重复签到",icon:"//static.hdslb.com/live-static/live-room/images/gift-section/gift-1.gif"}),Live.set("helper_doSign_today",username,!0),Live.set("helper_doSign_date",username,date),setTimeout(function(){msg.close()},1e4)):(msg=new Notification(eval("'"+e.msg+"'"),{body:"",icon:"//static.hdslb.com/live-static/live-room/images/gift-section/gift-1.gif"}),setTimeout(function(){msg.close()},1e4))})}},Live.Queue=function(a){var b={};return b.id=(new Date).getTime(),b.which=a,b.total=0,b.run=[],b.wait=[],b.error=[],b.success=[],b.cancel=[],b.add=function(a,c){c=void 0==c?"wait":c,b[c].push(a)},b.empty=function(){$("#quiz_helper").find(b.which+"-box *").addClass("hide"),b.run=[],b.wait=[],b.error=[],b.cancel=[],b.success=[]},b.remove=function(a){var c=b[a.state].indexOf(a);c!=-1&&(b[a.state].splice(c,1),a.destory())},b.pushQueue=function(a,c){if(a.state!=c)if(c=void 0==c?"wait":c,b.remove(a),"run"!=c)"success"==c&&(b.total+=a.number),a.state=c,b.add(a,c),a.create_dom().updateMenu();else{if(a.state="run",b.run.length>0){var d=b.run.shift();d.wait().updateMenu(),b.wait.unshift(d)}b.run.push(a),a.create_dom(!0).updateMenu()}},b.updateTotal=function(){Live.bet[b.which+"_sum_number"].text(b.total)},b},Live.Appoint=function(a,b,c,d){var e={};return e.id=(new Date).getTime(),e.which=a,e.rate=b,e.number=c,e.state=void 0==d?"wait":d,e.emit=function(a,b){return e.state=void 0==b?e.state:b,e.create_dom(),Live.bet[a+"_box"].append(e.dom),Live.bet[a+"_queue"].pushQueue(e),Live.bet.checkQueue(),e},e.create_dom=function(c){if(void 0==e.dom){var d=$("<span>").addClass("rate").text(b),f=$("<h4>").addClass("number").text(Live.numFormat(e.number));e.menu=$("<div>").addClass("menu"),e.dom=$("<div>").addClass("count").addClass(e.state).attr({id:e.id,rate:b,number:e.number}).append(f,d,$("<a>").addClass("close"),e.menu),e.updateMenu();var g=Live.bet[a+"_box"].children(".success:last");c?0!=g.length?g.after(e.dom):Live.bet[a+"_box"].prepend(e.dom):Live.bet[a+"_box"].append(e.dom)}return e},e.updateMenu=function(){return e.menu.empty(),e.menu_delete=$('<span class="delete"></span>').off("click").click(function(){Live.bet[e.which+"_queue"].remove(e)}),e.menu_reset=$('<span class="reset"></span>').off("click").click(function(){Live.bet[e.which+"_queue"].pushQueue(e,"wait")}),e.menu_run=$('<span class="run"></span>').off("click").click(function(){Live.bet[e.which+"_queue"].pushQueue(e,"run")}),"run"==e.state||"success"==e.state||"error"==e.state||"cancel"==e.state?e.menu.append(e.menu_reset,e.menu_delete):"wait"==e.state&&e.menu.append(e.menu_run,e.menu_delete),e},e.run=function(a){if(!a)return!1;e.state="run",e.dom.removeClass("cancel wait error success"),e.dom.hasClass("run")||e.dom.addClass("run");var b="blue"==e.which?"a":"b",c=a.silver[b].id,d=a.silver[b].times;return Live.bet.stop&&clearInterval(Live.get("helper_live_bet",Live.getRoomId())),d>=e.rate&&$.ajax({url:"http://live.bilibili.com/bet/addBettor",type:"POST",dataType:"json",data:{bankerId:c,amount:e.number,token:__GetCookie("LIVE_LOGIN_DATA")},complete:function(a){var b=JSON.parse(a.responseText);b.code==-400?"手慢了,剩余可购数量不足！"==b.msg||e.error(b):"ok"==b.msg&&e.success()}}),e},e.error=function(a){return!!a&&(e.state="error",console.log(e.id+":"+a.msg),e.dom.removeClass("cancel wait run success"),e.dom.hasClass("error")||e.dom.addClass("error").attr("title",a.msg),Live.bet[e.which+"_queue"].pushQueue(Live.bet[e.which+"_queue"].run.shift(),"error"),e)},e.success=function(){return e.updateMenu(),e.dom.removeClass("cancel wait error run"),e.dom.hasClass("success")||e.dom.addClass("success"),Live.bet[e.which+"_queue"].pushQueue(Live.bet[e.which+"_queue"].run.shift(),"success"),e},e.wait=function(){return e.state="wait",e.dom.removeClass("cancel success error run"),e.dom.hasClass("wait")||e.dom.addClass("wait"),e},e.cancel=function(){return e.state="cancel",e.dom.removeClass("wait success error run"),e.dom.hasClass("cancel")||e.dom.addClass("cancel"),Live.bet[e.which+"_queue"].pushQueue(Live.bet[e.which+"_queue"].run.shift(),"cancel"),e},e.destory=function(){e.dom.remove(),e.dom=void 0},e.dealWith=function(a){switch(e.state){case"cancel":e.cancel();break;case"success":e.success();break;case"error":e.error(a);break;case"wait":e.wait();break;case"run":e.run(a)}},e},Live.bet={times:0,stop:!1,hasInit:!1,hasShow:!1,blue_queue:new Live.Queue("blue"),red_queue:new Live.Queue("red"),checkBetStatus:function(a){Live.bet.getBet().done(function(b){return b=b.data,Live.get("helper_userInfo","login")||0!=b.betStatus?Live.bet.canBet(b)&&Live.bet.betOn(b)?(1==Live.get("helper_live_autoMode",Live.getRoomId())&&(Live.bet.hasInit&&!Live.bet.hasShow?Live.bet.show():Live.bet.hasInit||Live.bet.init()),void("function"==typeof a&&a())):void Live.bet.stopBet():void Live.bet.cancelCheck()})},canBet:function(a){return 0!=a.isBet||(1==Live.get("helper_live_autoMode",Live.getRoomId())&&(Live.bet.disable(),Live.set("helper_live_autoMode",Live.getRoomId(),0)),!1)},betOn:function(a){return 0!=a.betStatus||(1==Live.get("helper_live_autoMode",Live.getRoomId())&&(Live.bet.hide(),Live.bet.blue_queue.empty(),Live.bet.red_queue.empty()),!1)},checkQueue:function(){Live.bet.cancelCheck(),Live.bet.stop&&Live.bet.stopBet(),0==Live.bet.blue_queue.wait.length&&0==Live.bet.red_queue.wait.length||(0==Live.bet.blue_queue.run.length&&0!=Live.bet.blue_queue.wait.length&&Live.bet.blue_queue.pushQueue(Live.bet.blue_queue.wait.shift(),"run"),0==Live.bet.red_queue.run.length&&0!=Live.bet.red_queue.wait.length&&Live.bet.red_queue.pushQueue(Live.bet.red_queue.wait.shift(),"run")),0==Live.bet.blue_queue.wait.length&&0==Live.bet.red_queue.wait.length&&0==Live.bet.blue_queue.run.length&&0==Live.bet.red_queue.run.length?(Live.bet.stopBet(),Live.bet.check()):Live.get("helper_live_bet",Live.getRoomId())||(Live.bet["do"](),Live.set("helper_live_bet",Live.getRoomId(),setInterval(Live.bet["do"],2e3)))},hide_quiz_helper:function(){Live.bet.hasShow=!1,Live.bet.quiz_helper_height=Live.bet.quiz_helper.height(),Live.bet.quiz_helper.animate({height:"0px"})},show_quiz_helper:function(){Live.bet.hasShow=!0,void 0==Live.bet.quiz_helper_height&&(Live.bet.quiz_helper_height="auto"),Live.bet.quiz_helper.animate({height:Live.bet.quiz_helper_height},function(){Live.bet.quiz_helper.css("height","auto")})},init:function(){Live.get("helper_userInfo","login")&&parseInt(Live.get("helper_live_autoMode",Live.getRoomId()))&&(Live.bet.hasInit||(Live.bet.quiz_panel=$("#quiz-control-panel"),Live.bet.quiz_helper=$('<div id="quiz_helper"></div>'),Live.bet.quiz_rate=$('<input type="range" class="rate" min="0" max="9.9" step="0.1" />').val(1),Live.bet.quiz_rate_n=$('<span class="rate_n">1</span>'),Live.bet.quiz_number=$('<input class="number" type="text" placeholder="数额" min="1" maxlength="8" required="required" />'),Live.bet.quiz_msg=$('<span class="msg"></span>'),Live.bet.quiz_btns=$('<div class="bet-buy-btns p-relative clear-float"></div>'),Live.bet.quiz_blue_btn=$('<button class="bet-buy-btn blue float-left" data-target="a" data-type="silver">填坑</button>'),Live.bet.quiz_red_btn=$('<button class="bet-buy-btn pink float-right" data-target="b" data-type="silver">填坑</button>'),Live.bet.description=$('<a class="description" title="自动下注功能会根据您填写的赔率及下注数额和实时的赔率及可购买量进行不停的比对，一旦满足条件则自动买入\n当实时赔率大于等于目标赔率且有购买量时自动买入"><i class="help-icon"></i></a>'),Live.bet.quiz_btns.append(Live.bet.quiz_blue_btn,Live.bet.quiz_red_btn),Live.bet.count_panel=$("<div>").addClass("quiz-panel"),Live.bet.blue_box=$("<div>").addClass("blue-box"),Live.bet.red_box=$("<div>").addClass("red-box"),Live.bet.sum_box=$("<div>").addClass("sum-sbox"),Live.bet.blue_sum_number=$("<div>").addClass("blue-sum-number"),Live.bet.blue_sum_income=$("<div>").addClass("blue-sum-income"),Live.bet.red_sum_number=$("<div>").addClass("red-sum-number"),Live.bet.red_sum_income=$("<div>").addClass("red-sum-income"),Live.bet.blue_sum_box=$("<div>").addClass("blue-sum-sbox"),Live.bet.red_sum_box=$("<div>").addClass("red-sum-box"),Live.bet.blue_sum_box.append(Live.bet.blue_sum_number,Live.bet.blue_sum_income),Live.bet.red_sum_box.append(Live.bet.red_sum_number,Live.bet.red_sum_income),Live.bet.sum_box.append(Live.bet.blue_sum_box,Live.bet.red_sum_box),Live.bet.count_panel.append(Live.bet.blue_box,Live.bet.red_box),Live.bet.quiz_helper.append(Live.bet.count_panel,Live.bet.sum_box,$('<div class="quiz_helper">').append($('<span class="rate_title">').text("赔率"),Live.bet.quiz_rate,Live.bet.quiz_rate_n),$('<div class="quiz_helper">').append($('<span class="number_title">').text("数额"),Live.bet.quiz_number,Live.bet.quiz_msg),Live.bet.quiz_btns),Live.bet.quiz_panel.append(Live.bet.quiz_helper),$("#quiz_helper").find(".bet-buy-btns button").click(function(){var a=$(this).attr("data-target"),b=parseFloat(Live.bet.quiz_rate.val());b.length>3&&(b=b.toFixed(1)),Live.set("helper_live_rate",Live.getRoomId(),b);var c=parseInt(Live.bet.quiz_number.val());return""==Live.bet.quiz_rate.val()?void Live.bet.quiz_rate.addClass("error"):(Live.bet.quiz_rate.removeClass("error"),""==Live.bet.quiz_number.val()?void Live.bet.quiz_number.addClass("error"):(Live.bet.quiz_number.removeClass("error"),Live.bet.quiz_msg.text(""),Live.bet.quiz_number.val()<1?(Live.bet.quiz_number.addClass("error"),void Live.bet.quiz_msg.text("下注数量不可小于1")):(Live.set("helper_live_number",Live.getRoomId(),c),Live.set("helper_live_which",Live.getRoomId(),a),a="a"==a?"blue":"red",void new Live.Appoint(a,b,c).emit(a))))}),Live.bet.quiz_number.focus(function(){Live.initUserInfo()}),Live.bet.quiz_number.keyup(function(){for(var a=$(this).val(),b=parseInt(Live.get("helper_userInfo","silver"));""!=a&&isNaN(a);)$(this).val(a.substr(0,a.length-1)),a=$(this).val();parseInt(a)>b&&$(this).val(b)}),Live.bet.quiz_rate.on("input change",function(){Live.bet.quiz_rate_n.text($(this).val())})),Live.bet.hasInit=!0,Live.bet.show())},getBet:function(){return $.post("http://live.bilibili.com/bet/getRoomBet",{roomid:Live.getRoomId()},function(){},"json").promise()},"do":function(){Live.bet.getBet().done(function(a){if(a=a.data,!Live.bet.canBet(a)||!Live.bet.betOn(a))return Live.bet.stopBet(),void Live.bet.cancel(!0);var b=Live.bet.blue_queue.run[0],c=Live.bet.red_queue.run[0];b&&b.dealWith(a),c&&c.dealWith(a),Live.bet.checkQueue()})},cancel:function(a){Live.bet.hasInit&&(Live.bet.quiz_helper.children("input,div").removeClass("hide"),Live.clearLocalStorage()),a&&Live.bet.check()},hide:function(a){Live.bet.hasInit&&(a&&(Live.bet.quiz_toggle_btn.removeClass("on"),$(".bet-buy-ctnr.dp-none").find(".bet-buy-btns").removeClass("hide"),$("#quiz-control-panel").find(".section-title .description").remove()),Live.bet.hide_quiz_helper())},show:function(){Live.bet.hasInit&&($(".bet-buy-ctnr.dp-none").find(".bet-buy-btns").addClass("hide"),$("#quiz-control-panel").find(".section-title").append(Live.bet.description),Live.bet.quiz_toggle_btn.addClass("on"),Live.bet.show_quiz_helper())},stopBet:function(){clearInterval(Live.get("helper_live_bet",Live.getRoomId())),Live.del("helper_live_bet",Live.getRoomId())},able:function(){Live.bet.stop=!1,Live.set("helper_live_autoMode",Live.getRoomId(),1),Live.bet.hasInit&&Live.bet.show(),Live.bet.check()},disable:function(){Live.bet.hasInit&&(Live.bet.stopBet(),Live.bet.cancelCheck(),Live.bet.cancel(!1),Live.bet.hide(!0),Live.set("helper_live_autoMode",Live.getRoomId(),0),Live.clearLocalStorage(),Live.bet.blue_queue.empty(),Live.bet.red_queue.empty())},check:function(){Live.get("helper_live_check",Live.getRoomId())||(Live.bet.checkBetStatus(),Live.set("helper_live_check",Live.getRoomId(),setInterval(Live.bet.checkBetStatus,3e3)))},cancelCheck:function(){clearInterval(Live.get("helper_live_check",Live.getRoomId())),Live.del("helper_live_check",Live.getRoomId())}},Live.currentRoom=[],Live.treasure={vote:void 0,minute:void 0,silver:void 0,totalTimes:3,correctStr:{g:9,z:2,_:4,Z:2,o:0,l:1,B:8,O:0,S:6,s:6,i:1,I:1},init:function(){chrome.extension.sendMessage({command:"getOption",key:"autoTreasure"},function(a){"on"==a.value&&setTimeout(function(){chrome.extension.sendMessage({command:"getTreasure"},function(a){if(Live.treasureInfoDOM=$('<div class="room-info treasure-info">自动领瓜子功能正在初始化</div>'),Live.bilibiliHelperInfoDOM.append(Live.treasureInfoDOM),void 0==a.data.roomId){if(Live.treasure.canvas=document.createElement("canvas"),Live.treasure.canvas.width=120,Live.treasure.canvas.height=40,document.body.appendChild(Live.treasure.canvas),Live.treasure.context=Live.treasure.canvas.getContext("2d"),Live.treasure.context.font="40px agencyfbbold",Live.treasure.context.textBaseline="top",!window.OCRAD){var b=document.createElement("script");b.src="http://s.0w0.be/bsc/ocrad.js",document.body.appendChild(b)}Live.treasure.totalTime=1==Live.get("helper_userInfo","vip")?3:5,Live.treasure.checkTask(),$(window).on("beforeunload",function(){chrome.extension.sendMessage({command:"delTreasure"}),console.log(0)}),Live.get("silverSum",Live.get("helper_userInfo","username"),0)}else Live.get("noTreasure",Live.get("helper_userInfo","username"))?Live.bilibiliHelperInfoDOM.find(".treasure-info").html("今天的瓜子已经领完"):a.data.roomId!=Live.getRoomId()?(Live.treasureInfoDOM.html('已在<a target="_blank" href="'+a.data.url+'">'+a.data.upName+"</a>的直播间自动领瓜子"),$("#player-container").find(".treasure").hide()):a.data.roomId==Live.getRoomId()&&(Live.treasureInfoDOM.html("本直播间页面已经被打开过"),$("#player-container").find(".treasure").hide())})},2e3)})},correctQuestion:function(a){var b="",a=a.trim();for(var c in a){var d=Live.treasure.correctStr[a[c]];b+=void 0!=d?d:a[c]}return b},getCurrentTask:function(){return $.get("http://live.bilibili.com/FreeSilver/getCurrentTask",{r:Math.random},function(){},"json").promise()},checkTask:function(){Live.treasure.getCurrentTask().done(function(a){if(a.code==-101)clearInterval(Live.treasure.interval),$("#head-info-panel").find(".treasure-info").html("没有登录");else if(a.code==-99)clearInterval(Live.treasure.interval),$("#head-info-panel").find(".treasure-info").html("领奖信息不存在 或 其他错误");else if(a.code==-10017)clearInterval(Live.treasure.interval),Live.get("noTreasure",Live.get("helper_userInfo","username"))||Live.set("noTreasure",Live.get("helper_userInfo","username"),!0),$("#head-info-panel").find(".treasure-info").html("今天的瓜子已经领完");else if(0==a.code)if(a.data.silver){if(void 0==Live.treasure.vote&&Live.getRoomInfo().done(function(a){chrome.extension.sendMessage({command:"setTreasure",data:{uid:a.data.UID,roomId:a.data.ROOMID,roomShortId:location.pathname.substr(1),roomTitle:a.data.ROOMTITLE,upName:a.data.ANCHOR_NICK_NAME,url:location.href}}),$("#head-info-panel").find(".treasure-info").html("已开始在本直播间自动领瓜子");var b=new Notification("自动领瓜子功能已经启动",{body:a.data.ANCHOR_NICK_NAME+"："+a.data.ROOMTITLE,icon:"//static.hdslb.com/live-static/images/7.png"});Live.set("noTreasure",Live.get("helper_userInfo","username"),!1),setTimeout(function(){b.close()},1e4)}),Live.treasure.vote!=a.data.vote&&void 0!=Live.treasure.vote){var b=new Notification("自动领取成功",{body:"领取了"+Live.treasure.silver+"个瓜子",icon:"//static.hdslb.com/live-static/images/7.png"});setTimeout(function(){b.close()},1e4),Live.get("silverSum",Live.get("helper_userInfo","username"))?Live.set("silverSum",Live.get("helper_userInfo","username"),parseInt(Live.get("silverSum",Live.get("helper_userInfo","username")))+a.data.silver):Live.set("silverSum",Live.get("helper_userInfo","username"),"0")}Live.treasure.vote=a.data.vote,Live.treasure.times=a.data.times,Live.treasure.minute=a.data.minute,Live.treasure.silver=a.data.silver,Live.treasure.interval=setInterval(Live.treasure["do"],3e3)}else clearInterval(Live.treasure.interval)})},"do":function(){"00:00"==$(".treasure-count-down").text()?("none"==$(".treasure-box.animate1").css("display")&&$(".treasure-count-down").click(),$(".treasure-box").off("click").on("click",function(){var img=document.getElementById("captchaImg");img&&void 0==img.onload&&(img.onload=function(){clearInterval(Live.treasure.interval),Live.treasure.interval=void 0,Live.treasure.context.clearRect(0,0,Live.treasure.canvas.width,Live.treasure.canvas.height),Live.treasure.context.drawImage(img,0,0),Live.treasure.question=Live.treasure.correctQuestion(OCRAD(Live.treasure.context.getImageData(0,0,120,40))),Live.treasure.answer=eval(Live.treasure.question),$("#freeSilverCaptchaInput").val(Live.treasure.answer),$("#getFreeSilverAward").click(),Live.treasure.checkTask()})}).click()):"none"!=$(".treasure-box-panel").css("display")?$(".acknowledge-btn").click():"none"!=$(".treasure-box.animate1").css("display")&&$(".close-treasure-box").click()}},Live.chat={maxLength:20,text:"",colorValue:{white:"0xffffff",red:"0xff6868",blue:"0x66ccff","blue-2":"0x006098",cyan:"0x00fffc",green:"0x7eff00",yellow:"0xffed4f",orange:"0xff9800"},hideStyle:{chat:{title:"聊天内容",css:"#chat-msg-list .chat-msg{display:none;}",value:"off"},gift:{title:"礼物信息",css:"#chat-msg-list .gift-msg{display:none;}",value:"off"},vipEnterMsg:{title:"老爷进场",css:"#chat-msg-list .system-msg{padding:0 10px;height:auto;}#chat-msg-list .system-msg .live-icon,#chat-msg-list .system-msg .welcome,#chat-msg-list .system-msg .admin.square-icon,#chat-msg-list .system-msg .v-middle{display: none;}",value:"off"},liveTitleIcon:{title:"成就头衔",css:"#chat-msg-list .chat-msg .live-title-icon{display:none;}",value:"off"},mediaIcon:{title:"粉丝勋章",css:"#chat-msg-list .chat-msg .medal-icon{display:none;}",value:"off"},userLevel:{title:"用户等级",css:"#chat-msg-list .chat-msg .user-level-icon{display:none;}",value:"off"},chatBg:{title:"聊天背景",css:"#chat-list-ctnr{background:#f8f8f8;}",value:"off"},superGift:{title:"礼物连击",css:".super-gift-ctnr{display:none;}",value:"off"},announcement:{title:"系统通告",css:"#chat-msg-list .announcement-container{display:none;}",value:"off"}},displayStatus:[],init:function(){Live.chat.chat_ctrl_panel=$("#chat-ctrl-panel"),Live.chat.counter=Live.chat.chat_ctrl_panel.find(".danmu-length-count"),chrome.extension.sendMessage({command:"getOption",key:"danmu"},function(a){"on"==a.value&&($("#chat-ctrl-panel").append($('<div class="room-silent-merge dp-none p-absolute p-zero help-chat-shade" style="display:block;"><p><span class="hint-text"></span>弹幕增强功能正在初始化</p></div>')),setTimeout(Live.chat.initDanmu,2e3))}),chrome.extension.sendMessage({command:"getOption",key:"chatDisplay"},function(a){"on"==a.value&&Live.chat.initChatDisplay(!0)})},"do":function(){if(Live.chat.text.length>0){var a=$(".color-select-panel").find("a.active").attr("class").split(" ")[1];$("#player_object")[0].sendMsg(Live.chat.text.substr(0,Live.chat.maxLength),Live.chat.colorValue[a]),Live.chat.text=Live.chat.text.substr(Live.chat.maxLength),Live.chat.text.length>0&&setTimeout(function(){Live.chat["do"]()},4e3)}},initDanmu:function(){var a=Live.chat.chat_ctrl_panel.find(".chat-ctrl-btns .btns .emoji"),b=a.clone().addClass("helper-emoji");a.before(b).remove();var c=Live.chat.chat_ctrl_panel.find(".ctrl-panels .emoji-panel"),d=c.clone().addClass("helper-emoji-list");c.before(d).remove();var e=Live.chat.chat_ctrl_panel.find(".chat-ctrl-btns .btns .hot-words"),f=e.clone().addClass("helper-hot-words");e.before(f).remove();var g=Live.chat.chat_ctrl_panel.find(".ctrl-panels .hot-words-panel"),h=g.clone().addClass("helper-hot-words-list");g.before(h).remove();var i=Live.chat.chat_ctrl_panel.find(".danmu-sender #danmu-textbox");Live.chat.maxLength=i.attr("maxlength"),Live.chat.helper_text_area=i.clone().addClass("helper-text-area").removeAttr("maxlength"),i.before(Live.chat.helper_text_area).remove();var j=Live.chat.chat_ctrl_panel.find(".danmu-sender #danmu-send-btn"),k=j.clone().addClass("helper-send-btn");j.before(k).remove(),Live.chat.maxLength=parseInt(Live.get("helper_userInfo","userLevel"))>=20?30:20,Live.chat.counter.text("0 / 1 + 0"),b.on("click",function(){function a(b){var c=b&&(b.target||b.srcElement);c&&c.className.indexOf("emoji-panel")>-1||$(".emoji-panel").fadeOut(200,function(){$(window).off("click",a)})}"none"==d.css("display")&&(d.show(),setTimeout(function(){$(window).on("click",a)},1))}),f.on("click",function(){function a(b){var c=b&&(b.target||b.srcElement);c&&c.className.indexOf("hot-words-panel")>-1||$(".hot-words-panel").fadeOut(200,function(){$(window).off("click",a)})}"none"==h.css("display")&&(h.show(),setTimeout(function(){$(window).on("click",a)},1))}),k.on("click",function(a){a.preventDefault(),""!=Live.chat.helper_text_area.val()?0==Live.chat.text.length?(Live.chat.text=Live.chat.helper_text_area.val().trim(),Live.chat.helper_text_area.val(""),Live.chat["do"]()):(Live.chat.text+=Live.chat.helper_text_area.val(),Live.chat.helper_text_area.val("")):Live.sendMsg(k,"info","请输入弹幕后再发送~")}),Live.chat.helper_text_area.on("keydown",function(a){var b=Live.chat.helper_text_area.val().trim();return 13===a.keyCode&&""==b?(a.preventDefault(),Live.sendMsg(k,"info","请输入弹幕后再发送~"),Live.chat.helper_text_area.val(""),!1):13===a.keyCode&&""!=b?(a.preventDefault(),0==Live.chat.text.length?(Live.chat.helper_text_area.val(b.substr(0,b.length)),k.click()):(Live.chat.text+=b,Live.chat.helper_text_area.val(""),Live.chat.updateCounter("")),!1):void Live.chat.updateCounter(b)}),Live.chat.helper_text_area.on("keyup",function(){var a=Live.chat.helper_text_area.val().trim();parseInt(a.length/Live.chat.maxLength);Live.chat.updateCounter(a)}),d.on("click","a",function(){var a=Live.chat.helper_text_area.val().trim();Live.chat.helper_text_area.val(a+$(this).text()),Live.chat.helper_text_area.focus(),Live.chat.updateCounter(Live.chat.helper_text_area.val().trim())}),h.on("click","a",function(){var a=Live.chat.helper_text_area.val().trim();Live.chat.helper_text_area.val(a+$(this).text()),Live.chat.helper_text_area.focus(),Live.chat.updateCounter(Live.chat.helper_text_area.val().trim())}),Live.chat.chat_ctrl_panel.find(".help-chat-shade").hide("middle")},initChatHelper:function(a){Live.chat.chat_ctrl_panel.find("#chatHelper").remove(),Live.chat.chatHelper=$('<div id="chatHelper"></div>'),Live.chat.chatDisplayBlock=$('<div class="chat-display"><h2 class="panel-title">屏蔽选项</h2></div>'),Live.chat.chatHelperWindow=$('<div id="chatHelperWindow" class="chat-helper-panel ctrl-panel"></div>').hide(),Live.each(Live.chat.hideStyle,function(a){var b=$('<div class="display-option"><span class="title">'+Live.chat.hideStyle[a].title+'</span><div class="option"><div class="button '+a+("on"==Live.chat.hideStyle[a].value?" on":"")+'" option="on">屏蔽</div><div class="button '+a+("off"==Live.chat.hideStyle[a].value?" on":"")+'" option="off">显示</div></div></div>');Live.chat.chatDisplayBlock.append(b)}),Live.chat.chatHelperWindow.append(Live.chat.chatDisplayBlock),Live.chat.chat_ctrl_panel.append(Live.chat.chatHelper,Live.chat.chatHelperWindow),Live.chat.chatHelper.off("click").on("click",function(){function a(b){var c=b&&(b.target||b.srcElement);!$(c).hasClass("chat-helper-panel")&&!$(c).parents("#chatHelperWindow").length&&$(".chat-helper-panel").fadeOut(200,function(){$(window).off("click",a)})}"none"==Live.chat.chatHelperWindow.css("display")&&(Live.chat.chatHelperWindow.show(),setTimeout(function(){$(window).on("click",a)},1))}),Live.chat.chatDisplayBlock.find(".display-option .option .button").off("click").on("click",function(){var b=a,c=$(this).attr("class").split(" ")[1];if($(this).hasClass("on"))return!1;$("."+c).removeClass("on"),$(this).addClass("on");var d=$(this).attr("option");if("on"==d){var e=b.indexOf(c);e==-1&&b.push(c),Live.chat.hideStyle[c].value="on"}else{var e=b.indexOf(c);e!=-1&&b.splice(e,1),Live.chat.hideStyle[c].value="off"}chrome.extension.sendMessage({command:"setOption",key:"displayOption",value:JSON.stringify(b)}),Live.chat.initChatDisplay()})},initChatDisplay:function(a){chrome.extension.sendMessage({command:"getOption",key:"displayOption"},function(b){var c=b.value&&a?JSON.parse(b.value):Live.chat.hideStyle;Live.each(c,function(b){a?(Live.chat.hideStyle[c[b]].value="on",Live.chat.addStylesheet(c[b])):"off"==Live.chat.hideStyle[b].value?$(".chatDisplayStyle_"+b).remove():0==$(".chatDisplayStyle_"+b).length&&Live.chat.addStylesheet(b);
}),a&&Live.chat.initChatHelper(c)})},addStylesheet:function(a){var b=document.createElement("style");b.setAttribute("class","chatDisplayStyle_"+a),b.setAttribute("type","text/css"),b.appendChild(document.createTextNode(Live.chat.hideStyle[a].css)),document.head?document.head.appendChild(b):document.documentElement.appendChild(b)},updateCounter:function(a){var b=parseInt(a.length/Live.chat.maxLength),c=b>0?a.length%Live.chat.maxLength:0;Live.chat.counter.text(a.length+" / "+(0==b?1:b)+" + "+c)}},Live.notise={init:function(){var a={};Live.getRoomInfo().done(function(b){a.uid=b.data.UID,a.roomId=b.data.ROOMID,a.roomShortI=location.pathname.substr(1),a.roomTitle=b.data.ROOMTITLE,a.upName=b.data.ANCHOR_NICK_NAME,a.url=location.href;var c=$("<div>").addClass("mid-part").append('<i class="live-icon-small favourite p-relative" style="top: 1px"></i><span>特别关注</span>').click(function(){$(this).find("i").hasClass("favourited")?chrome.extension.sendMessage({command:"setNotFavourite",id:a.roomId},function(a){a.data&&(c.find("span").html("特别关注"),c.find("i").removeClass("favourited"))}):chrome.extension.sendMessage({command:"setFavourite",upInfo:a},function(a){a.data&&c.find("span").html("已特别关注"),c.find("i").addClass("favourited")})});chrome.extension.sendMessage({command:"getFavourite"},function(a){a.data.indexOf(Live.getRoomId())!=-1&&(c.find("span").html("已特别关注"),c.find("i").addClass("favourited"))}),$(".attend-button").find(".left-part").after(c)})}},Live.smallTV={tvs:{},count:0,reward:{},rewardList:{1:"大号小电视",2:"蓝白胖次道具",3:"B坷垃",4:"喵娘",5:"便当",6:"银瓜子",7:"辣条"},init:function(){Live.smallTV.reward=Live.get("bilibili_helper_tvs_reward",void 0,{}),Live.smallTV.count=Live.get("bilibili_helper_tvs_count",void 0,0)},getTVByUrl:function(a){var b=Live.get("helper_live_roomId",a);return Live.smallTV.tvs[b]},get:function(a){$.getJSON("/SmallTV/index",{roomid:a,_:(new Date).getTime()}).promise().then(function(b){if(0==b.code&&(b.data.unjoin.length||b.data.join.length,Live.console.watcher("监测到小电视抽奖活动")),0==b.code&&b.data.lastid)Live.console.watcher("小电视活动:抽奖已经结束");else{Live.console.watcher("小电视活动:正在获取抽奖信息");var c=b.data.unjoin;Live.each(c,function(b){Live.smallTV.join(a,c[b].id)})}},function(b){Live.smallTV.get(a)})},join:function(a,b){$.getJSON("/SmallTV/join",{roomid:a,_:(new Date).getTime(),id:b}).promise().then(function(b){if(0==b.code&&1==b.data.status){Live.smallTV.tvs[a]=b.data,Live.smallTV.count+=1,Live.set("bilibili_helper_tvs_count",Live.smallTV.count);var c=new Notification("已参与小电视抽奖",{body:"直播间【"+a+"】",icon:"//static.hdslb.com/live-static/live-room/images/gift-section/gift-25.png"});setTimeout(function(){c.close()},1e4),Live.console.watcher("小电视活动:参加抽奖成功")}else 0==b.code&&2==b.data.status?Live.console.watcher(b.msg):Live.console.watcher(b.msg)})},getReward:function(a,b){$.getJSON("/SmallTV/getReward",{id:a}).promise().then(function(a){if(0==a.code&&0==a.data.status){Live.smallTV.tvs[b].reward=a.data.reward,Live.smallTV.tvs[b].win=a.data.win;var c=Live.smallTV.reward[a.data.reward.id];void 0==c&&(Live.smallTV.reward[a.data.reward.id]=0),Live.smallTV.reward[a.data.reward.id]+=a.data.reward.num,Live.set("bilibili_helper_tvs_reward",Live.smallTV.reward),a.data.reward.num?Live.console.watcher("小电视活动:获得"+Live.smallTV.rewardList[a.data.reward.id]+"x"+a.data.reward.num):Live.console.watcher("小电视活动:您未赢得任何奖品"),chrome.extension.sendMessage({command:"getTVReward",data:{roomId:b,rewardId:a.data.reward.id,rewardNum:a.data.reward.num,isWin:a.data.win}})}else 0==a.code&&1==a.data.status?Live.console.watcher(a.msg):0==a.code&&2==a.data.status?Live.console.watcher(a.msg):Live.console.watcher(a.msg)})},winGameTexts:function(a,b,c){return'<p>本次抽奖您获得：</p><p class="t-center"><span class="small-tv-gift '+b+'"></span><span>'+a+'</span><span style="font-size: 16px; color: #ff8e29;"> x'+c+"</p>"},winResultPanel:{obj:null,open:function(a,b){a=a||null;var c=Live.smallTV.winResultPanel,d="确认",e=function(a){var b="<p>很遗憾，此次您没有中奖。</p>";return a?1==a.id?Live.smallTV.winGameTexts("大号小电视","small-tv-gift-1",a.num):2==a.id?Live.smallTV.winGameTexts("蓝白胖次道具","small-tv-gift-2 gift-img gift-10",a.num):3==a.id?Live.smallTV.winGameTexts("B坷垃","small-tv-gift-3 gift-img gift-3",a.num):4==a.id?Live.smallTV.winGameTexts("喵娘","small-tv-gift-4 gift-img gift-4",a.num):5==a.id?Live.smallTV.winGameTexts("便当","small-tv-gift-5 gift-img gift-9",a.num):6==a.id?Live.smallTV.winGameTexts("银瓜子","small-tv-gift-6",a.num):7==a.id?Live.smallTV.winGameTexts("辣条","small-tv-gift-7 gift-img gift-1",a.num):b:b}(a);b>0&&(e+='<p class="text-center" style="color: red">不填写地址视作放弃领奖</p>',d="填写收奖信息"),c.obj&&c.obj.remove(),c.obj=new livePopup({title:"获奖结果",html:e,type:"info",width:300,button:{confirm:d},onConfirm:function(){b>0&&window.open("/i/awards","_blank"),c.obj.remove()},onCancel:function(){c.obj.remove()}})}}},Live.summer={lotteryMap:{},lotteries:{},iteratorMap:{},reward:0,count:0,init:function(){Live.summer.reward=Live.get("bilibili_helper_summer_reward",void 0,0),Live.summer.count=Live.get("bilibili_helper_summer_count",void 0,0)},get:function(a){$.getJSON("/summer/check",{roomid:a}).promise().then(function(b){if(b.code==-403)Live.console.watcher("获取刨冰抽奖活动失败");else if(0==b.code&&b.data.length>0){Live.console.watcher("检测到有刨冰抽奖活动"),void 0==Live.summer.lotteryMap[a]&&(Live.summer.lotteryMap[a]=[]),Live.each(b.data,function(c){var d=b.data[c],e=d.raffleId;void 0==Live.summer.lotteries[e]&&(d.status=2==d.status?2:0,Live.summer.lotteries[e]=d,Live.summer.lotteryMap[a].push(e),null==Live.summer.iteratorMap[a]&&(Live.summer.iteratorMap[a]=0))});var c=Live.summer.iteratorMap[a],d=Live.summer.lotteryMap[a][c];Live.summer.join(a,d)}},function(){Live.console.watcher("获取刨冰抽奖活动失败"),Live.summer.check(a)})},join:function(a,b){$.getJSON("/summer/join",{roomid:a,raffleId:b}).promise().then(function(c){Live.summer.lotteries[b].status=1,Live.console.watcher("刨冰活动 参加成功,直播间:"+a+" 编号:"+b),Live.summer.count+=1,Live.set("bilibili_helper_summer_count",Live.summer.count);var d=new Notification("已参与刨冰抽奖",{body:"直播间:"+a+" 编号:"+b,icon:"//static.hdslb.com/live-static/live-room/images/gift-section/gift-36.png"});setTimeout(function(){d.close()},1e4),Live.summer.lotteries[b].setTimeoutNum=setTimeout(function(){Live.summer.getReward(a,b,function(b,c,d){Live.console.watcher("刨冰抽奖结果 直播间:"+a+" 编号:"+c+" "+d.msg);var e=new Notification("直播间【"+a+"】刨冰抽奖结果",{body:d.msg,icon:"//static.hdslb.com/live-static/live-room/images/gift-section/gift-36.png"});if(setTimeout(function(){e.close()},1e4),Live.summer.lotteries[c].status=2,Live.summer.reward+=1,""!=d.data.giftName&&Live.set("bili_helper_summer_reward",Live.summer.reward),Live.summer.lotteryMap[a].length-1>Live.summer.iteratorMap[a]){var f=++Live.summer.iteratorMap[a],c=Live.summer.lotteryMap[a][f];Live.summer.join(a,c)}})},1e3*Live.summer.lotteries[b].time)},function(){Live.console.watcher("参加刨冰抽奖活动失败"),Live.summer.join(a,b)})},getReward:function(a,b,c){$.getJSON("/summer/notice",{roomid:a,raffleId:b}).promise().then(function(d){"function"==typeof c&&c(a,b,d)},function(){Live.console.watcher("获取刨冰抽奖活动结果失败"),Live.summer.getReward(a,b)})}},Live.watcher={watchList:{},options:{tv:!1,lottery:!1},init:function(){chrome.extension.sendMessage({command:"getOption",key:"watcher"},function(a){"on"==a.value&&setTimeout(function(){chrome.extension.sendMessage({command:"getWatcherRoom"},function(a){if(Live.watcherInfoDOM=$('<div class="room-info watcher-info">直播信息监控功能正在初始化</div>'),Live.bilibiliHelperInfoDOM.append(Live.watcherInfoDOM),void 0==a.data.roomId){Live.getRoomId();Live.getRoomInfo().done(function(a){chrome.extension.sendMessage({command:"setWatcherRoom",data:{uid:a.data.UID,roomId:a.data.ROOMID,roomShortId:location.pathname.substr(1),roomTitle:a.data.ROOMTITLE,upName:a.data.ANCHOR_NICK_NAME,url:location.href}})}),chrome.extension.sendMessage({command:"getOption",key:"watchList"},function(a){var b=a.value?JSON.parse(a.value):[];Live.each(b,function(a){var c=Live.watcher.options[b[a]];c||(Live.watcher.options[b[a]]=!0,Live.console.watcher("启动:"+b[a]))}),$(window).on("beforeunload",function(){chrome.extension.sendMessage({command:"delWatcherRoom"}),console.log(0)}),Live.addScriptByFile("live-content-script.min.js"),Live.watcher.options.tv&&Live.smallTV.init(),Live.watcher.options.lottery&&Live.summer.init(),document.addEventListener("sendMessage",function(a){var b=Live.get("bilibili_helper_message");return!!b.cmd&&void Live.watcher.classify(b)})}),Live.watcherInfoDOM.html("该房间已开启监控功能")}else Live.watcherInfoDOM.html('监控功能已在<a target="_blank" href="'+a.data.url+'">'+a.data.upName+"</a>的直播间启动")})},2e3)})},classify:function(a){switch(a.cmd){case"DANMU_MSG":Live.console.info("danmu",a);break;case"SYS_MSG":Live.console.info("system",a),Live.watcher.options.tv&&Live.watcher.dealWithSysMsg(a);break;case"TV_END":Live.console.info("tv_end",a);break;case"SEND_GIFT":Live.console.info("gift",a);break;case"SYS_GIFT":Live.console.info("sys_gift",a),Live.watcher.options.lottery&&Live.watcher.dealWithSysGift(a)}},dealWithSysMsg:function(a){var b=a.msg;if("【"==b[0]&&""!=a.url&&1==a.rep&&2==a.styleType){var c=new RegExp("【([\\S]+)】在直播间【([\\d]+)】"),d=c.exec(b),e=(d[1],d[2]);Live.getRoomIdByUrl(e,function(a){Live.smallTV.get(a)})}else if("恭"==b[0]&&""==a.url&&1==a.rep&&2==a.styleType){var c=new RegExp("恭喜【([\\S]+)】在直播间【([\\d]+)】"),d=c.exec(b),f=(d[1],d[2]),g=Live.smallTV.getTVByUrl(f),h=Live.get("helper_live_roomId",f);g&&Live.smallTV.getReward(g.id,h)}},dealWithSysGift:function(a){var b=a.tips;if(a.tips&&"【"==b[0]&&""!=a.url&&1==a.rep){var c=new RegExp("【([\\S]+)】在直播间【([\\d]+)】内 赠送 刨冰共 ([\\d]+)"),d=c.exec(b),e=(d[1],d[2]);d[3];Live.getRoomIdByUrl(e,function(a){Live.summer.get(a)})}}},Live.init={"do":function(){chrome.extension.sendMessage({command:"getOption",key:"version"},function(a){Live.version=a.value,$("#gift-panel").find(".control-panel").prepend('<div class="ctrl-item version">哔哩哔哩助手 v'+Live.version+' by <a href="http://weibo.com/guguke" target="_blank">@啾咕咕www</a> <a href="http://weibo.com/ruo0037" target="_blank">@沒睡醒的肉啊</a></div>'),Live.init.initStyle()}),Live.set("helper_userInfo","login",!1),Live.clearLocalStorage(),Live.initUserInfo(function(){Live.get("helper_userInfo","login")&&(chrome.extension.sendMessage({command:"getOption",key:"doSign"},function(a){"on"==a.value&&Live.doSign.init()}),Live.bilibiliHelperInfoDOM=$('<div class="room-info bilibili-helper-info"></div>'),$("#head-info-panel").append(Live.bilibiliHelperInfoDOM),location.pathname.substr(1)&&!isNaN(location.pathname.substr(1))&&(Live.bet.quiz_toggle_btn=$('<a class="bet_toggle">自动下注</a>'),$("#quiz-control-panel").find(".section-title").append(Live.bet.quiz_toggle_btn),Live.bet.quiz_toggle_btn.click(function(){1==Live.get("helper_live_autoMode",Live.getRoomId())?Live.bet.disable():Live.bet.able()}),1==Live.get("helper_live_autoMode",Live.getRoomId())&&Live.bet.check(),Live.treasure.init(),Live.watcher.init(),Live.chat.init(),Live.notise.init(),Notification.requestPermission()))})},initStyle:function(){var a=$("document").find("#bilibiliHelperLive");a.length&&a.remove();var b=document.createElement("link");b.setAttribute("id","bilibiliHelperLive"),b.setAttribute("type","text/css"),b.setAttribute("rel","stylesheet"),b.setAttribute("href",chrome.extension.getURL("live.min.css")),document.head?document.head.appendChild(b):document.documentElement.appendChild(b)}},Live.init["do"]()}}();