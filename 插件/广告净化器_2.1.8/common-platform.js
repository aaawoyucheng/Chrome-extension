var BrowserTab,BrowserTabs;!function(){"use strict";function e(e){var n=new BrowserTab({id:e.tabId});"websocket"===e.type&&0===e.url.indexOf("http")&&(e.url=e.url.replace(/^http(s)?:/,"ws$1:"));var o,r={requestTime:e.timeStamp,requestUrl:e.url,tab:n},i=0,s=0;switch(e.type){case"main_frame":i=0,o=g.RequestTypes.DOCUMENT;break;case"sub_frame":i=e.frameId,s=e.parentFrameId,o=g.RequestTypes.SUBDOCUMENT;break;default:s=e.frameId,o=e.type.toUpperCase()}return s==-1&&(s=0),o===g.RequestTypes.OTHER&&(o=t(e.url)),r.frameId=i,r.requestFrameId=s,r.requestType=o,e.requestHeaders&&(r.requestHeaders=e.requestHeaders),e.responseHeaders&&(r.responseHeaders=e.responseHeaders),r}function t(e){d.href=e;var t=d.pathname,n=g.platformUtils.parseContentTypeFromUrlPath(t);return null==n&&(n=g.RequestTypes.OBJECT),n}var n=n||chrome,o=function(){yiclearCommon.BaseEvent.apply(this,arguments)};o.prototype={__proto__:yiclearCommon.BaseEvent.prototype};var r=function(){o.call(this,n.tabs.onCreated)};r.prototype={__proto__:o.prototype,specifyListener:function(e){return function(t){e(new BrowserTab(t))}}};var i=function(){o.call(this,n.tabs.onUpdated)};i.prototype={__proto__:o.prototype,specifyListener:function(e){return function(t,n,o){"loading"==n.status&&e(new BrowserTab(o))}}};var s=function(){o.call(this,n.tabs.onUpdated)};s.prototype={__proto__:o.prototype,specifyListener:function(e){return function(t,n,o){"complete"==n.status&&e(new BrowserTab(o))}}};var a=function(){o.call(this,n.tabs.onUpdated)};a.prototype={__proto__:o.prototype,specifyListener:function(e){return function(t,n,o){e(new BrowserTab(o))}}};var u=function(){o.call(this,n.tabs.onActivated)};u.prototype={__proto__:o.prototype,specifyListener:function(e){return function(t){n.tabs.get(t.tabId,function(t){w()||t&&e(new BrowserTab(t))})}}};var c=function(){o.call(this,n.tabs.onRemoved)};c.prototype={__proto__:o.prototype,specifyListener:function(e){return function(t){e(new BrowserTab({id:t}))}}};var d=document.createElement("a"),p=function(){yiclearCommon.BaseEvent.call(this,n.webRequest.onBeforeRequest)};p.prototype={__proto__:yiclearCommon.BaseEvent.prototype,specifyListener:function(t){return function(n){if(n.tabId==-1)return{};var o=e(n),r=t(o);return 1!=r&&0!=r?r:{cancel:0==r}}},getOptExtraInfoSpec:function(e){return[e?{urls:e}:{},["blocking"]]}};var f=function(){yiclearCommon.BaseEvent.call(this,n.webRequest.onHeadersReceived)};f.prototype={__proto__:yiclearCommon.BaseEvent.prototype,specifyListener:function(t){return function(n){if(n.tabId!=-1){var o=e(n);t(o)}}},getOptExtraInfoSpec:function(e){return[e?{urls:e}:{},["responseHeaders"]]}};var l=function(){yiclearCommon.BaseEvent.call(this,n.webRequest.onBeforeSendHeaders)};l.prototype={__proto__:yiclearCommon.BaseEvent.prototype,specifyListener:function(t){return function(n){if(n.tabId!=-1){var o=e(n);return t(o)}}},getOptExtraInfoSpec:function(e){return[e?{urls:e}:{},["requestHeaders","blocking"]]}};var w=function(){return n.runtime.lastError};BrowserTab=function(e){this.id=e.id,this.url=e.url,this.active=e.active,this.title=e.title,this.windowId=e.windowId,this.incognito=e.incognito},BrowserTab.prototype={close:function(){n.tabs.remove(this.id,w)},activate:function(){n.tabs.update(this.id,{selected:!0},w),n.windows.update(this.windowId,{focused:!0},w)},sendMessage:function(e,t){(n.tabs.sendMessage||n.tabs.sendRequest)(this.id,e,t)},reload:function(e){e?n.tabs.update(this.id,{url:e},w):n.tabs.reload(this.id,{},w)},executeScript:function(e,t){n.tabs.executeScript(this.id,e,function(){w()||t()})},insertCSS:function(e,t){n.tabs.insertCSS(this.id,e,function(){w()||t()})},equals:function(e){return this.id==e.id}},BrowserTabs=function(e){this.tabsById={},this.incognitoTabsById={},this.options=e,this._delete=this._delete.bind(this)},BrowserTabs.prototype={get:function(e){return(this.tabsById[e.id]||{}).value},set:function(e,t){this.tabsById[e.id]={tab:e,value:t}},has:function(e){return e.id in this.tabsById},clear:function(){for(var e in this.tabsById)this._delete(this.tabsById[e].tab)},collection:function(){var e=[];for(var t in this.tabsById)e.push(this.tabsById[t].value);return e},checkIncognitoMode:function(e){this.incognitoTabsById[e.id]=e.incognito},isIncognito:function(e){return this.incognitoTabsById[e.id]},remove:function(e){this._delete(e)},_delete:function(e){delete this.tabsById[e.id],delete this.incognitoTabsById[e.id]}};var b=function(e){this.id=e.id,this.visible="minimized"!=e.state};b.prototype={getAllTabs:function(e){n.tabs.query({windowId:this.id},function(t){e(t.map(function(e){return new BrowserTab(e)}))})},getActiveTab:function(e){var t={windowId:this.id,active:!0};n.tabs.query(t,function(t){t&&t.length>0&&e(new BrowserTab(t[0]))})},openTab:function(e,t,o){var r={windowId:this.id,url:e,active:!t};n.tabs.create(r,function(e){o&&o(new BrowserTab(e))})}};var g=window.vAPI||{};g.ext={},g.ext.ver=null,g.ext.getURL=n.extension.getURL,g.ext.onMessage=new yiclearCommon.OnMessageEvent,g.ext.i18n=n.i18n,g.ext.backgroundPage={},g.ext.backgroundPage.getWindow=function(){return n.extension.getBackgroundPage()},g.ext.backgroundPage.sendMessage=yiclearCommon.SendMessageFunction,g.ext.app={getId:function(){return n.runtime.id},getVersion:function(){return n.runtime.getManifest().version},getLocale:function(){return n.i18n.getUILanguage()},getUrlScheme:function(){var e=g.ext.getURL("bg.html"),t=e.indexOf("://");return e.substring(0,t)},getBrowserVersion:function(){return null!=g.ext.ver?g.ext.ver:(g.ext.ver=parseInt(/\d+/i.exec(/Chrome\/\d+\.\d+\.\d+\.\d+/i.exec(navigator.userAgent))),g.ext.ver)}},g.ext.windows={getAll:function(e){n.windows.getAll(function(t){e(t.map(function(e){return new b(e)}))})},getLastFocused:function(e){n.windows.getLastFocused(function(t){e(new b(t))})},getOrCreate:function(e,t){var o=function(e){return!("normal"!=e.type||e.incognito&&t)};n.windows.getLastFocused(function(t){return o(t)?void e(new b(t)):void n.windows.getAll(function(t){for(var r=0;r<t.length;r++){var i=t[r];if(o(i))return void function(t){n.windows.update(t.id,{focused:!0},function(){w()||e(new b(t))})}(i)}n.windows.create({},function(t){e(new b(t))})})})},onFocusChanged:{addListener:function(e){n.windows.onFocusChanged.addListener(function(t){t!=n.windows.WINDOW_ID_NONE&&e()})}},createPopup:function(e,t){n.windows.create({url:e,type:"popup",width:1230,height:630},function(e){t&&t(new b(e))})}},g.ext.tabs={onCreated:new r,onLoading:new i,onUpdated:new a,onCompleted:new s,onActivated:new u,onRemoved:new c,sendMessage:n.tabs.sendMessage,getLastFocused:function(e){n.tabs.query({lastFocusedWindow:!0,active:!0},function(t){e&&t&&t.length>0&&e(new BrowserTab(t[0]))})}},g.ext.webRequest={onBeforeRequest:new p,handlerBehaviorChanged:n.webRequest.handlerBehaviorChanged,onCompleted:n.webRequest.onCompleted,onErrorOccurred:n.webRequest.onErrorOccurred,onHeadersReceived:new f,onBeforeSendHeaders:new l,webSocketSupported:"undefined"!=typeof n.webRequest.ResourceType&&"websocket"===n.webRequest.ResourceType.WEBSOCKET};var h={addListener:function(e){n.webNavigation.onCommitted.addListener(function(t){t.tabId!==-1&&e(t.tabId,t.frameId,t.url)})}};g.ext.webNavigation={onCreatedNavigationTarget:n.webNavigation.onCreatedNavigationTarget,onCommitted:h},g.ext.browserAction={setBrowserAction:function(e,t,o,r,i){var s=e.id,a=function(){w()||n.tabs.get(s,function(){w()||(n.browserAction.setBadgeText({tabId:s,text:o}),w()||o&&(n.browserAction.setBadgeBackgroundColor({tabId:s,color:r}),w()))})};n.browserAction.setIcon({tabId:s,path:t},a)}},g.ext.pagesAction={setPagesAction:function(e,t,o,r){var i=e.id,s=function(){w()||n.tabs.get(i,function(){w()||(n.pageAction.setTitle({tabId:i,title:r}),w()||o&&(n.pageAction.setPopup({tabId:i,popup:"pages/popup.html"}),n.pageAction.show(i),w()))})};n.pageAction.setIcon({tabId:i,path:t},s)}},g.ext.contextMenus=n.contextMenus}();