!function(e,t){e.ApplicationUpdateService={getRunInfo:function(){var r=t.Utils,i=e.Prefs.version,n=r.getAppVersion();r.setAppVersion(i);var a=i!=n,l=i!=n&&n;return!e.userSettings.UpdateFirstRun()&&l&&(a=!1),{isFirstRun:a,isUpdate:l,currentVersion:i,prevVersion:n}},onUpdate:function(e,t){var r=[],i=this._executeMethods(r);i.then(t)},_executeMethods:function(e){var r=new t.vPromise,i=function(){if(0==e.length)r.resolve();else{var t=e.shift(),n=t.call(this);n.then(i)}}.bind(this);return i(),r},_onUpdateToSaveFilterRulesToDifferentFiles:function(){var r=new t.vPromise;return e.FilterStorage.loadFromDisk(function(i){var n=Object.create(null),a=function(){if(0==i.length){t.LocalStorage.setItem("yiclear-filters",JSON.stringify(n));var l=function(){};t.FileStorage.removeFile(e.FilterStorage.FILE_PATH,l,l),r.resolve()}else{var s=i.shift();n[s.filterId]={version:s.version,lastCheckTime:s.lastCheckTime,lastUpdateTime:s.lastUpdateTime,disabled:s.disabled};var o=new t.vPromise,v=t.CollectionUtils.getRulesText(s.filterRules);e.FilterStorage.saveFilterRules(s.filterId,v,o.resolve),o.then(a)}};a()}),r},_onUpdateToMultiplySubscriptions:function(){"yiclear-filters"in t.LocalStorage.storage&&(this._saveInstalledFiltersOnUpdate(),this._saveFiltersVersionInfoOnUpdate(),t.LocalStorage.removeItem("yiclear-filters"));var e=new t.vPromise;return e.resolve(),e},_onUpdateRemoveIpResolver:function(){t.Log;t.LocalStorage.removeItem("ip-cache");var e=new t.vPromise;return e.resolve(),e},_onUpdateWhiteListService:function(){var r=new t.vPromise,i=t.AntiBannerFiltersId.WHITE_LIST_FILTER_ID;return e.FilterStorage.loadFilterRules(i,function(e){var i=[];if(!e)return void r.resolve();for(var n=0;n<e.length;n++)if(/^@@\/\/([^\/]+)\^\$document$/.test(e[n])){var a=RegExp.$1;i.indexOf(a)<0&&i.push(a)}t.LocalStorage.setItem("white-list-domains",JSON.stringify(i)),r.resolve()}.bind(this)),r},_onUpdateRuleHitStats:function(){e.filterRulesHitCount.cleanup();var r=new t.vPromise;return r.resolve(),r},_saveInstalledFiltersOnUpdate:function(){var r=e.FilterLSUtils,i=JSON.parse(t.LocalStorage.getItem("yiclear-filters"))||Object.create(null);for(var n in i){var a=i[n];if(n!=t.AntiBannerFiltersId.USER_FILTER_ID&&n!=t.AntiBannerFiltersId.WHITE_LIST_FILTER_ID){var l={filterId:n,loaded:!0};a.disabled||(l.installed=!0,l.enabled=!0),r.updateFilterStateInfo(l)}}},_saveFiltersVersionInfoOnUpdate:function(){var r=e.FilterLSUtils,i=JSON.parse(t.LocalStorage.getItem("yiclear-filters"))||Object.create(null);for(var n in i){var a=i[n],l={filterId:n,version:a.version,lastCheckTime:a.lastCheckTime,lastUpdateTime:a.lastUpdateTime};r.updateFilterVersionInfo(l)}}}}(yiclearAPI,vAPI);