!function(t,e){t.UI={ICON_OPEN:e.ext.getURL("icons/new-19.png"),ICON_CLOSE:e.ext.getURL("icons/new-19-close.png"),nextMenuId:0,browserActionTitle:e.ext.i18n.getMessage("name"),updateTabIconAndContextMenu:function(t,e){e&&yiclear.framesMap.reloadFrameData(t),this.updateTabIcon(t),this.updateTabContextMenu(t)},getAllOpenedTabs:function(t){var n=e.ext,i=[],o=[],a=function(t){var n=new e.vPromise;return t.getAllTabs(function(t){o=o.concat(t),n.resolve()}),n},s=new e.vPromise;n.windows.getAll(function(t){i=o.concat(t),s.resolve()}),s.then(function(){for(var n=[],s=0;s<i.length;s++)n.push(a(i[s]));e.vPromise.all(n).then(function(){t(o)})})},openTab:function(n,i){var o,a,s,c,r=e.ext,u=e.StringUtils,p=e.UrlUtils;i&&(o=i.inBackground,a=i.activateSameTab,s=i.onOpen,c=i.tabType);var l=function(t){t.url!=n&&t.reload(n),o||t.activate(),s&&s(t)};"Edge"!=t.Prefs.platform&&(n=u.contains(n,"://")?n:r.getURL(n));var d=!p.isHttpRequest(n);this.getAllOpenedTabs(function(t){if(a)for(var e=0;e<t.length;e++){var i=t[e];if(p.urlEquals(i.url,n))return void l(i)}"popup"==c?r.windows.createPopup(n,s):r.windows.getOrCreate(function(t){t.openTab(n,o,s)},d)})},openOptions:function(){var n=e.ext,i=n.getURL("pages/install.html"),o=n.getURL("pages/options.html");n.windows.getLastFocused(function(e){e.getAllTabs(function(n){for(var a=0;a<n.length;a++){var s=n[a];if(s.url==i||s.url==o)return s.active||s.activate(),void(s.url!=o&&("Edge"==t.Prefs.platform?s.reload("pages/options.html"):s.reload(o)))}"Edge"==t.Prefs.platform?e.openTab("pages/options.html"):e.openTab(o)})})},openInstallPage:function(){this.openTab("pages/install.html",{inBackground:!1})},openExportRulesTab:function(t){this.openTab("pages/export.html#"+t)},updateTabIcon:function(n,i){if(t.userSettings.showtabIcon()){var o;if(i)o=i.icon;else{var a,s,c=yiclear.framesMap.getFrameInfo(n);c.yiclearDetected?(s=c.documentWhiteListed,a=""):(s=c.applicationFilteringDisabled,s=s||c.urlFilteringDisabled,s=s||c.documentWhiteListed,a=!s&&t.userSettings.showPageStatistic()?c.totalBlockedTab.toString():"0"),o=s?e.ext.getURL("icons/new-19-close.png"):c.yiclearDetected?this.ICON_OPEN:e.ext.getURL("icons/new-32.png")}var r=chrome||r;"undefined"==typeof r.pageAction?e.ext.browserAction.setBrowserAction(n,o,"","#555",this.browserActionTitle):(e.ext.pagesAction.setPagesAction(n,o,!0,this.browserActionTitle),"undefined"!=typeof sogouExplorer&&e.ext.browserAction.setBrowserAction(n,o,!0,"#555",this.browserActionTitle))}},updateTabIconAsync:e.platformUtils.debounce(function(e){t.UI.updateTabIcon(e)},250),_getBlockedCountText:function(t){var e="0"==t?"":t;return t-0>999&&(e="âˆž"),e},updateTabContextMenu:function(n){e.ext.contextMenus.removeAll(),t.userSettings.showContextMenu()&&t.UI.customizeContextMenu(n)},customizeContextMenu:function(n){function i(t,n){var i,a={contexts:["all"],title:e.ext.i18n.getMessage(t)};n&&(n.id&&(a.id=n.id),n.parentId&&(a.parentId=n.parentId),n.disabled&&(a.enabled=!1),n.messageArgs&&(a.title=ext.i18n.getMessage(t,n.messageArgs)),n.contexts&&(a.contexts=n.contexts),i=n.callbackTitle);var s=o[i||t];s&&(a.onclick=s),e.ext.contextMenus.create(a)}var o={context_open_log:function(){var e=t.filteringLog.getTabInfo(n),i=e?e.tabId:null;t.UI.openFilteringLog(i)},context_open_block:function(){t.UI.openAssistant(!0)}};i("context_open_block")},openAssistant:function(t){this._getCurrentTab(function(e){e.sendMessage({type:"initAssistant",options:{selectElement:t}})})},showAlertMessagePopup:function(t,n,i){e.ext.windows.getLastFocused(function(e){e.getActiveTab(function(e){if(e){if(!i&&yiclear.framesMap.isTabyiclearDetected(e))return;e.sendMessage({type:"show-alert-popup",title:t,text:n})}})})},bindEvents:function(){var n=e.EventNotifier;n.addListener(function(n,i,o){if(n==e.EventNotifierTypes.UPDATE_TAB_BUTTON_STATE&&i){var a;o&&(a={icon:t.UI.ICON_CLOSE,badge:""}),t.UI.updateTabIcon(i,a)}}),n.addListener(function(t,n,i,o){if(t==e.EventNotifierTypes.ADS_BLOCKED&&i){var a=yiclear.framesMap.updateBlockedAdsCount(i,o);null!=a&&this.updateTabIconAsync(i)}}.bind(this)),n.addListener(function(n,i){n==e.EventNotifierTypes.CHANGE_USER_SETTINGS&&i==t.userSettings.settings.DISABLE_SHOW_CONTEXT_MENU&&e.ext.windows.getLastFocused(function(e){e.getActiveTab(function(e){t.UI.updateTabContextMenu(e)})})}),e.ext.tabs.onLoading.addListener(function(e){t.UI.updateTabIconAndContextMenu(e)}),e.ext.tabs.onCompleted.addListener(function(e){t.UI.updateTabIconAndContextMenu(e)}),e.ext.tabs.onActivated.addListener(function(e){t.UI.updateTabIconAndContextMenu(e,!0)}),e.ext.windows.onFocusChanged.addListener(function(){e.ext.windows.getLastFocused(function(e){e.getActiveTab(function(e){t.UI.updateTabIconAndContextMenu(e,!0)})})})},getAssistantCssOptions:function(){return{cssLink:[e.ext.getURL("assistant/css/assistant.css")]}},whiteListTab:function(t){var e=yiclear.framesMap.getFrameInfo(t);yiclear.antiBannerService.whiteListFrame(e),this.updateTabIconAndContextMenu(t,!0)},whiteListCurrentTab:function(){this._getCurrentTab(function(t){this.whiteListTab(t)}.bind(this))},unWhiteListTab:function(t){var e=yiclear.framesMap.getFrameInfo(t);yiclear.antiBannerService.unWhiteListFrame(e),this.updateTabIconAndContextMenu(t,!0)},unWhiteListCurrentTab:function(){this._getCurrentTab(function(t){this.unWhiteListTab(t)}.bind(this))},_getCurrentTab:function(t){e.ext.tabs.getLastFocused(function(e){e&&t&&t(e)})},openFilteringLog:function(t){"undefined"!=typeof sogouExplorer?this.openTab("pages/debug.html"+(t?"#"+t:""),{activateSameTab:!0,tabType:"panel"}):this.openTab("pages/debug.html"+(t?"#"+t:""),{activateSameTab:!0,tabType:"popup"})},openIssue:function(){this.openTab("https://www.yiclear.com/Issue.html",{activateSameTab:!0,tabType:"popup"})},openFeedback:function(){this.openTab("https://www.yiclear.com/ask/",{activateSameTab:!0,tabType:"popup"})}}}(yiclearAPI,vAPI);