!function(e,t){t.ContentMessageHandler=function(){this.handleMessage=this.handleMessage.bind(this)},t.ContentMessageHandler.prototype={eventListeners:Object.create(null),sendMessageToSender:null,init:function(e,t,s,i,r,a){this.webRequestService=e,this.framesMap=s,this.filteringLog=i,this.BlockService=t,this.yiclearApplication=r,this.UI=a},setSendMessageToSender:function(e){this.sendMessageToSender=e},handleMessage:function(s,i,r){switch(s.type){case"getSelectorsAndScripts":var a=this.webRequestService.processGetSelectorsAndScripts(i.tab,s.documentUrl,s.options);return a||{};case"initializeFiltersOnInstall":return this.BlockService.initializeFiltersOnInstall(function(e){r({enabledFilterIds:e})}),!0;case"openOptions":this.UI.openOptions();break;case"processShouldCollapse":if(!e.Prefs.collapseByContentScript)return{collapse:!1,requestId:s.requestId};var n=this.webRequestService.processShouldCollapse(i.tab,s.elementUrl,s.documentUrl,s.requestType);return{collapse:n,requestId:s.requestId};case"processShouldCollapseMany":var l=this.webRequestService.processShouldCollapseMany(i.tab,s.documentUrl,s.requests);return{requests:l};case"getWhiteListDomains":var o=this.BlockService.getWhiteListDomains(s.offset,s.limit,s.text);return{rules:o};case"clearWhiteListFilter":this.BlockService.clearWhiteListFilter();break;case"addWhiteListDomain":this.BlockService.addWhiteListDomain(s.text);break;case"addWhiteListDomains":this.BlockService.addWhiteListDomains(s.domains);break;case"removeWhiteListDomain":this.BlockService.removeWhiteListDomain(s.text);break;case"initializeFrameScript":return this._processInitializeFrameScriptRequest();case"addEventListener":return this._processAddEventListener(s,i);case"removeListener":var c=s.listenerId;t.EventNotifier.removeListener(c),delete this.eventListeners[c];break;case"openExportRulesTab":this.UI.openExportRulesTab(s.filename);break;case"updatefilterUrl":this.BlockService._updateFilterUrl(s.filterId,function(e){r({info:e})});break;case"getfiltersmetadata":var d=this.BlockService.getFiltersMetadata();return{metadata:d};case"addfilterUrl":this.BlockService._getUserFilterRule(s.url,function(e){r({info:e})});break;case"addfilterUrl1":return this.BlockService._getUserFilterRule(s.url,function(e){r({info:e})}),!0;case"resetBlockedAdsCount":this.framesMap.resetBlockedAdsCount();break;case"addAndEnableFilter":this.BlockService.addAndEnableFilter(s.filterId);break;case"disableBlockFilter":this.BlockService.disableAntiBannerFilter(s.filterId);break;case"removeBlockFilter":this.BlockService.removeAntiBannerFilter(s.filterId);break;case"enableBlockFilter":this.BlockService.enableAntiBannerFilter(s.filterId);break;case"addUserRule":this.BlockService.addUserFilterRule(s.ruleText);break;case"clearUserFilter":this.BlockService.clearUserFilter();break;case"addUserFilterRule":this.BlockService.addUserFilterRule(s.text);break;case"addUserFilterRules":this.BlockService.addUserFilterRules(s.rules);break;case"getUserFilters":var u=this.BlockService.getUserFilters(s.offset,s.limit,s.text);return{rules:u};case"removeUserFilter":this.BlockService.removeUserFilter(s.text);break;case"getBlockedCount":var h=this.framesMap.getBlockedCount();return{BlockedCount:h};case"getTabFrameInfoById":var f=this.filteringLog.getTabFrameInfoById(s.tabId);return{frameInfo:f};case"getTabInfoById":var g=this.filteringLog.getTabInfoById(s.tabId);return{tabInfo:this.filteringLog.serializeTabInfo(g)};case"onCloseFilteringLogPage":this.filteringLog.onCloseFilteringLogPage();break;case"onOpenFilteringLogPage":this.filteringLog.onOpenFilteringLogPage();break;case"synchronizeOpenTabs":return this.filteringLog.synchronizeOpenTabs(function(e){r({tabs:e})}),!0;case"reloadTabById":this.filteringLog.reloadTabById(s.tabId);break;case"clearEventsByTabId":this.filteringLog.clearEventsByTabId(s.tabId);break;case"openTab":this.UI.openTab(s.url,s.options);break;case"loadAssistant":return this._processLoadAssistant();case"changeUserSetting":e.userSettings.setProperty(s.key,s.value);break;case"openissue":this.UI.openIssue();break;case"openfeedback":this.UI.openFeedback();break;case"getConfigs":var p=e.userSettings.getConfigs();return{rules:p};case"setConfigs":e.userSettings.setConfigs(s.configs);break;case"checkPageScriptWrapperRequest":var b=this.webRequestService.checkPageScriptWrapperRequest(i.tab,s.elementUrl,s.documentUrl,s.requestType);return{block:b,requestId:s.requestId};default:throw"Unknown message: "+s}},_processLoadAssistant:function(){var e=this.UI.getAssistantCssOptions(),t=["assistant_select_element","assistant_select_element_ext","assistant_select_element_cancel","assistant_block_element","assistant_block_element_explain","assistant_slider_explain","assistant_slider_min","assistant_slider_max","assistant_extended_settings","assistant_apply_rule_to_all_sites","assistant_block_by_reference","assistant_block_similar","assistant_block_class","assistant_block","assistant_another_element","assistant_preview","assistant_preview_header","assistant_preview_header_info","assistant_preview_end","assistant_preview_start"];return e.localization=this._getLocalization(t),e},_getLocalization:function(e){var t={};for(var s in e)if(e.hasOwnProperty(s)){var i=e[s];t[i]=i18n.getMessage(i)}return t},_processInitializeFrameScriptRequest:function(){for(var s=Object.create(null),i=this.BlockService.getFiltersMetadata(),r=0;r<i.length;r++){var a=i[r].filterId;if(a){var n=this.BlockService.isAntiBannerFilterEnabled(a);n&&(s[a]=!0)}}return{userSettings:e.userSettings.getAllSettings(),enabledFilters:s,filtersMetadata:this.BlockService.getFiltersMetadata(),requestFilterInfo:this.BlockService.getRequestFilterInfo(),contentBlockerInfo:this.BlockService.getContentBlockerInfo(),BlockedCount:this.framesMap.getBlockedCount(),environmentOptions:{isMacOs:t.platformUtils.isMacOs(),isSafariBrowser:t.platformUtils.isSafariBrowser(),isContentBlockerEnabled:t.platformUtils.isContentBlockerEnabled(),Prefs:{locale:e.Prefs.locale,mobile:e.Prefs.mobile}},constants:{AntiBannerFiltersId:t.AntiBannerFiltersId,EventNotifierTypes:t.EventNotifierTypes,LogEvents:t.LogEvents}}},_processAddEventListener:function(e,s){var i=this,r=t.EventNotifier.addSpecifiedListener(e.events,function(){var e=i.eventListeners[r];e&&i.sendMessageToSender(e,{type:"notifyListeners",args:Array.prototype.slice.call(arguments)})});return this.eventListeners[r]=s,{listenerId:r}}}}(yiclearAPI,vAPI);