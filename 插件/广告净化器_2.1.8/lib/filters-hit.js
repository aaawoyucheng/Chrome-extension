!function(t,e){t.filterRulesHitCount=function(){"use strict";var i=function(){var i=t.ClientService,s=t.userSettings,a=e.EventNotifier,n=e.EventNotifierTypes;this.serviceClient=new i,this._init(),this.collectStatsEnabled=s.collectHitsCount(),a.addListener(function(t,e){t==n.CHANGE_USER_SETTINGS&&e==s.settings.DISABLE_COLLECT_HITS&&(this.collectStatsEnabled=s.collectHitsCount())}.bind(this))};return i.prototype={MAX_PAGE_VIEWS_COUNT:20,HITS_COUNT_PROP:"filters-hit-count",HITS_PROP:"h",setAntiBannerService:function(t){this.antiBannerService=t},addDomainView:function(t){if(this.collectStatsEnabled&&t){var e=this.stats.domains;e||(this.stats.domains=e=Object.create(null));var i=e[t];i||(e[t]=i=Object.create(null),i.views=0),i.views++,this.stats.views=(this.stats.views||0)+1,this._saveHitsCountStats(this.stats)}},addRuleHit:function(t,i,s,a){var n=e.UrlUtils;if(this.collectStatsEnabled&&t&&i&&s){var r=this.stats.domains?this.stats.domains[t]:null;if(r){var c=r.rules;c||(r.rules=c=Object.create(null));var o=c[s];o||(c[s]=o=Object.create(null)),i in o||(o[i]=null);var l=o[i];if(l||(o[i]=l=Object.create(null)),a){var u=n.getDomainName(a),h=l[u]||0;l[u]=h+1}else{var S=l[this.HITS_PROP]||0;l[this.HITS_PROP]=S+1}this._saveHitsCountStats(this.stats)}}},cleanup:function(){var t=e.LocalStorage;this.stats=Object.create(null),t.removeItem(this.HITS_COUNT_PROP)},_init:function(){this.stats=this._getHitCountStats()},_getHitCountStats:function(){var t=e.LocalStorage,i=e.Log,s=t.getItem(this.HITS_COUNT_PROP),a=Object.create(null);try{s&&(a=JSON.parse(s))}catch(t){i.error("Error retrieve hit count statistic, cause {0}",t)}return a},_saveHitsCountStats:function(t){var i=e.LocalStorage,s=e.Log;this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){try{i.setItem(this.HITS_COUNT_PROP,JSON.stringify(t))}catch(t){s.error("Error save hit count statistic to storage, cause {0}",t)}this._sendStats()}.bind(this),2e3)},_sendStats:function(){var t=this.stats.views||0;t<this.MAX_PAGE_VIEWS_COUNT||this.collectStatsEnabled&&(this.antiBannerService,this.cleanup())}},new i}()}(yiclearAPI,vAPI);