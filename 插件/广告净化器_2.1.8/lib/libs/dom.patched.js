function DomPredictionHelper(){}DomPredictionHelper.prototype=new Object,DomPredictionHelper.prototype.recursiveNodes=function(e){var r;return r=e.nodeName&&e.parentNode&&e!=document.body?this.recursiveNodes(e.parentNode):new Array,r.push(e),r},DomPredictionHelper.prototype.escapeCssNames=function(e){if(!e)return"";try{return e.replace(/\s*sg_\w+\s*/g,"").replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/#/g,"\\#").replace(/\>/g,"\\>").replace(/\,/g,"\\,").replace(/\:/g,"\\:")}catch(r){return console.log("---"),console.log("exception in escapeCssNames"),console.log(e),console.log("---"),""}},DomPredictionHelper.prototype.childElemNumber=function(e){for(var r=0;e.previousSibling&&(e=e.previousSibling);)1==e.nodeType&&r++;return r},DomPredictionHelper.prototype.pathOf=function(e){for(var r=this.recursiveNodes(e),t=this,o="",n=0;n<r.length;n++){var s=r[n];if(s){o+=s.nodeName.toLowerCase();var i=s.id&&t.escapeCssNames(new String(s.id));if(i&&i.length>0&&(o+="#"+i),s.className)for(var l=s.className.split(/ /),c=0;c<l.length;c++){var i=t.escapeCssNames(l[c]);l[c]&&i.length>0&&(o+="."+i)}o+=":nth-child("+(t.childElemNumber(s)+1)+")",o+=" "}}return" "==o.charAt(o.length-1)&&(o=o.substring(0,o.length-1)),o},DomPredictionHelper.prototype.commonCss=function(e){try{var r=new diff_match_patch}catch(e){throw"Please include the diff_match_patch library."}if("undefined"==typeof e||0==e.length)return"";var t={},o=this.encodeCssForDiff(e,t),n=o.pop();return o.forEach(function(e){var t=r.diff_main(n,e);n="",t.forEach(function(e){0==e[0]&&(n+=e[1])})}),this.decodeCss(n,t)},DomPredictionHelper.prototype.tokenizeCss=function(e){for(var r=!1,t="",o=[],e=e.replace(/,/," , ").replace(/\s+/g," "),n=e.length,s="",i=0;i<n;i++)s=e[i],r?r=!1:"\\"==s?r=!0:"."!=s&&" "!=s&&"#"!=s&&">"!=s&&":"!=s&&","!=s||(t.length>0&&o.push(t),t=""),t+=s," "!=s&&","!=s||(o.push(t),t="");return t.length>0&&o.push(t),o},DomPredictionHelper.prototype.decodeCss=function(e,r){for(var t=this.invertObject(r),o="",n=e.split(""),s=0;s<n.length;s++)o+=t[n[s]];return this.cleanCss(o)},DomPredictionHelper.prototype.encodeCssForDiff=function(e,r){for(var t=50,o=this,n=[],s=0;s<e.length;s++){for(var i=new String,l=o.tokenizeCss(e[s]),c=0;c<l.length;c++){var a=l[c];r[a]||(r[a]=String.fromCharCode(t++)),i+=r[a]}n.push(i)}return n},DomPredictionHelper.prototype.simplifyCss=function(e,r,t){var o=this,n=o.tokenizeCss(e),s="";o.selectorGets("all",r,e)&&o.selectorGets("none",t,e)&&(s=e);for(var i=0;i<4;i++)for(var l=0;l<n.length;l++){var c=n[l].substring(0,1);if(!o.wouldLeaveFreeFloatingNthChild(n,l)&&(0==i&&":"==c||1==i&&":"!=c&&"."!=c&&"#"!=c&&" "!=c||2==i&&"."==c||3==i&&"#"==c)){var a=n[l];n[l]="";var p=o.cleanCss(n.join(""));if(""==p){n[l]=a;continue}o.selectorGets("all",r,p)&&o.selectorGets("none",t,p)?s=p:n[l]=a}}return o.cleanCss(s)},DomPredictionHelper.prototype.wouldLeaveFreeFloatingNthChild=function(e,r){return r-1>=0&&":"==e[r-1].substring(0,1)&&(r-2<0||" "==e[r-2])&&(r+1>=e.length||" "==e[r+1])||r+1<e.length&&":"==e[r+1].substring(0,1)&&(r+2>=e.length||" "==e[r+2])&&(r-1<0||" "==e[r-1])},DomPredictionHelper.prototype.cleanCss=function(e){return e.replace(/\>/," > ").replace(/,/," , ").replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").replace(/,$/,"")},DomPredictionHelper.prototype.getPathsFor=function(e){for(var r=this,t=[],o=0;o<e.length;o++){var n=e[o];n&&n.nodeName&&t.push(r.pathOf(n))}return t},DomPredictionHelper.prototype.predictCss=function(e,r){var t=this;if(0==e.length)return"";var o=t.getPathsFor(e),n=t.getPathsFor(r),s=t.commonCss(o),i=t.simplifyCss(s,o,n);if(i.length>0)return i;for(var l="",c=0;c<e.length;c++)l=t.pathOf(e[c])+", "+l;return l=t.cleanCss(l),t.simplifyCss(l,o,n)},DomPredictionHelper.prototype.fragmentSelector=function(e){for(var r=this,t=[],o=e.split(/\,/),n=0;n<o.length;n++){for(var s=[],i=r.cleanCss(o[n]).split(/\s+/),l=0;l<i.length;l++)s.push(r.tokenizeCss(i[l]));t.push(s)}return t},DomPredictionHelper.prototype.selectorBlockMatchesSelectorBlock=function(e,r){for(var t=0;t<e.length;t++)if(r.indexOf(e[t])==-1)return!1;return!0},DomPredictionHelper.prototype.selectorGets=function(e,r,t){var o=this,n=!0;if(0==r.length&&"all"==e)return!1;if(0==r.length&&"none"==e)return!0;for(var s=o.fragmentSelector(t),i=[],l=0;l<r.length;l++)i.push(o.fragmentSelector(r[l])[0]);for(var l=0;l<s.length;l++){if(!n)return;for(var c=s[l],a=0;a<i.length;l++){if(!n||""==i[a])return;o._selectorGets(i[a],c)&&("none"==e&&(n=!1),i[a]="")}}return"all"==e&&i.join("").length>0&&(n=!1),n},DomPredictionHelper.prototype._selectorGets=function(e,r){for(var t=!1,o=e.length-1,n=r.length-1;n>-1&&!t;n--)if(n==r.length-1)this.selectorBlockMatchesSelectorBlock(r[n],e[o])||(t=!0),o--;else{for(var s=!1;o>-1&&!s;)s=this.selectorBlockMatchesSelectorBlock(r[n],e[o]),o--;s||(t=!0)}return!t},DomPredictionHelper.prototype.invertObject=function(e){var r={};for(var t in e){var o=e[t];r[o]=t}return r},DomPredictionHelper.prototype.cssToXPath=function(e){var r=this.tokenizeCss(e);r[0]&&" "==r[0]&&r.splice(0,1),r[r.length-1]&&" "==r[r.length-1]&&r.splice(r.length-1,1);for(var t=[],o="",n=0;n<r.length;n++)" "==r[n]?(o+=this.cssToXPathBlockHelper(t),t=[]):t.push(r[n]);return o+this.cssToXPathBlockHelper(t)},DomPredictionHelper.prototype.cssToXPathBlockHelper=function(e){if(0==e.length)return"//";var r="//",t=e[0].substring(0,1);if(","==t)return" | ";":"!=t&&"#"!=t&&"."!=t||(r+="*");for(var o=[],n=null,s=0;s<e.length;s++){var i=e[s];t=i.substring(0,1);var l=i.substring(1);":"==t?(n=l.match(/^nth-child\((\d+)\)$/))&&o.push("(((count(preceding-sibling::*) + 1) = "+n[1]+") and parent::*)"):"."==t?o.push('contains(concat( " ", @class, " " ), concat( " ", "'+l+'", " " ))'):"#"==t?o.push('(@id = "'+l+'")'):","==t||(r+=i)}o.length>0&&(r+="[");for(var s=0;s<o.length;s++)r+=o[s],s<o.length-1&&(r+=" and ");return o.length>0&&(r+="]"),r};