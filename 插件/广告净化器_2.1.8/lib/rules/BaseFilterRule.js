!function(e,t){"use strict";var i=t.StringUtils,s=t.UrlUtils,r=t.Log,n=t.CollectionUtils;e.BaseFilterRule=function(e,t){this.ruleText=e,this.filterId=t},e.BaseFilterRule.prototype={loadDomains:function(e){if(!i.isEmpty(e)){var t=null,n=null,o=e.split(/[,|]/);try{for(var l=0;l<o.length;l++){var a,d=o[l];i.startWith(d,"~")?(a=s.toPunyCode(d.substring(1).trim()),i.isEmpty(a)||(null==n&&(n=[]),n.push(a))):(a=s.toPunyCode(d.trim()),i.isEmpty(a)||(null==t&&(t=[]),t.push(a)))}}catch(t){r.error("Error load domains from {0}, cause {1}",e,t)}this.setPermittedDomains(t),this.setRestrictedDomains(n)}},getPermittedDomains:function(){return this.permittedDomain?[this.permittedDomain]:this.permittedDomains},getRestrictedDomains:function(){return this.restrictedDomain?[this.restrictedDomain]:this.restrictedDomains},setRedirectUrl:function(e){return e&&0!=e.length?void(e.length>1?this.RedirectUrls=e:this.RedirectUrl=e[0]):(delete this.RedirectUrl,void delete this.RedirectUrls)},setReloadUrl:function(e){return e&&0!=e.length?void(e.length>1?this.ReloadUrls=e:this.ReloadUrl=e[0]):(delete this.ReloadUrl,void delete this.ReloadUrls)},setCountUrl:function(e){return e&&0!=e.length?void(e.length>1?this.BCounts=e:this.BCount=e[0]):(delete this.BCount,void delete this.BCounts)},setProxyUrl:function(e){return e&&0!=e.length?void(e.length>1?this.Proxys=e:this.Proxy=Proxy[0]):(delete this.Proxy,void delete this.Proxys)},setPermittedDomains:function(e){return e&&0!=e.length?void(e.length>1?this.permittedDomains=e:this.permittedDomain=e[0]):(delete this.permittedDomain,void delete this.permittedDomains)},setRestrictedDomains:function(e){return e&&0!=e.length?void(e.length>1?this.restrictedDomains=e:this.restrictedDomain=e[0]):(delete this.restrictedDomain,void delete this.restrictedDomains)},isDomainSensitive:function(){return this.hasRestrictedDomains()||this.hasPermittedDomains()},isGeneric:function(){return!this.hasPermittedDomains()},hasPermittedDomains:function(){return this.permittedDomain||this.permittedDomains&&this.permittedDomains.length>0},hasRestrictedDomains:function(){return this.restrictedDomain||this.restrictedDomains&&this.restrictedDomains.length>0},isPermitted:function(e){return!!e&&((!this.restrictedDomain||!s.isDomainOrSubDomain(e,this.restrictedDomain))&&((!this.restrictedDomains||!s.isDomainOrSubDomainOfAny(e,this.restrictedDomains))&&(!this.hasPermittedDomains()||(!(!this.permittedDomain||!s.isDomainOrSubDomain(e,this.permittedDomain))||s.isDomainOrSubDomainOfAny(e,this.permittedDomains)))))},addRestrictedDomains:function(e){if(e){if(this.hasPermittedDomains()){var t=this;e=e.filter(function(e){return t.isPermitted(e)})}var i=this.getRestrictedDomains();i=n.removeDuplicates((i||[]).concat(e)),this.setRestrictedDomains(i)}},removeRestrictedDomains:function(e){if(e){for(var t=this.getRestrictedDomains(),i=0;i<e.length;i++)n.remove(t,e[i]);this.setRestrictedDomains(t)}}},e.BaseFilterRule.escapeRule=function(e){return encodeURIComponent(e).replace(/'/g,"%27")},e.BaseFilterRule.PARAMETER_START="[",e.BaseFilterRule.PARAMETER_END="]",e.BaseFilterRule.MASK_WHITE_LIST="@@",e.BaseFilterRule.MASK_CONTENT_RULE="$$",e.BaseFilterRule.MASK_CSS_RULE="##",e.BaseFilterRule.MASK_CSS_EXCEPTION_RULE="#@#",e.BaseFilterRule.MASK_CSS_INJECT_RULE="#$#",e.BaseFilterRule.MASK_CSS_EXCEPTION_INJECT_RULE="#@$#",e.BaseFilterRule.MASK_SCRIPT_RULE="#%#",e.BaseFilterRule.MASK_SCRIPT_EXCEPTION_RULE="#@%#",e.BaseFilterRule.MASK_JS_RULE="%%",e.BaseFilterRule.MASK_BANNER_RULE="++",e.BaseFilterRule.MASK_CONFIGURATION_RULE="~~",e.BaseFilterRule.COMMENT="!",e.BaseFilterRule.EQUAL="=",e.BaseFilterRule.COMA_DELIMITER=",",e.BaseFilterRule.LINE_DELIMITER="|",e.BaseFilterRule.NOT_MARK="~",e.BaseFilterRule.OLD_INJECT_RULES="yiclear_start_style_inject",e.BaseFilterRule.MASK_REDIRECT_RULE="#r#",e.BaseFilterRule.MASK_REDIRECT_EXCEPTION_RULE="#b#"}(yiclearAPI,vAPI);