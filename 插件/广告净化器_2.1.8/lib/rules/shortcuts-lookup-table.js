!function(t,e){"use strict";var o=e.ArrayUtils,l=e.CollectionUtils,u=e.StringUtils,r="http:/",i="https:";t.ShortcutsLookupTable=function(t){if(this.lookupTable=Object.create(null),t)for(var e=0;e<t.length;e++)this.addRule(t[e])},t.ShortcutsLookupTable.prototype={addRule:function(t){var e=this._getRuleShortcut(t);if(!e||e==r||e==i)return!1;if(e in this.lookupTable){var l=this.lookupTable[e];o.isArray(l)?l.push(t):this.lookupTable[e]=[l,t]}else this.lookupTable[e]=t;return!0},removeRule:function(t){var e=this._getRuleShortcut(t);if(e&&e in this.lookupTable){var u=this.lookupTable[e];o.isArray(u)?(l.removeRule(u,t),0==u.length&&delete this.lookupTable[e]):delete this.lookupTable[e]}},clearRules:function(){this.lookupTable=Object.create(null)},lookupRules:function(e){for(var l=[],u=0;u<=e.length-t.ShortcutsLookupTable.SHORTCUT_LENGTH;u++){var r=e.substring(u,u+t.ShortcutsLookupTable.SHORTCUT_LENGTH),i=this.lookupTable[r];i&&(o.isArray(i)?l=l.concat(i):l.push(i))}return l},getRules:function(){var t=[];for(var e in this.lookupTable){var l=this.lookupTable[e];l&&(o.isArray(l)?t=t.concat(l):t.push(l))}return t},_getRuleShortcut:function(e){return u.isEmpty(e.shortcut)||e.shortcut.length<t.ShortcutsLookupTable.SHORTCUT_LENGTH?null:e.shortcut.substring(e.shortcut.length-t.ShortcutsLookupTable.SHORTCUT_LENGTH)}},t.ShortcutsLookupTable.SHORTCUT_LENGTH=6,t.DomainsLookupTable=function(t){if(this.lookupTable=Object.create(null),t)for(var e=0;e<t.length;e++)this.addRule(t[e])},t.DomainsLookupTable.prototype={addRule:function(t){var e=t.getPermittedDomains();if(!e||0===e.length)return!1;for(var o=0;o<e.length;o++){var l=e[o],u=this.lookupTable[l];u||(u=[],this.lookupTable[l]=u),u.push(t)}return!0},removeRule:function(t){var e=t.getPermittedDomains();if(e&&0!==e.length)for(var o=0;o<e.length;o++){var u=e[o],r=this.lookupTable[u];r&&(l.removeRule(r,t),0===r.length&&delete this.lookupTable[u])}},clearRules:function(){this.lookupTable=Object.create(null)},lookupRules:function(t){if(!t)return null;var e=t.split(".");if(0===e.length)return null;for(var o=null,l=e[e.length-1],u=e.length-2;u>=0;u--){l=e[u]+"."+l;var r=this.lookupTable[l];r&&r.length>0&&(null===o&&(o=[]),o=o.concat(r))}return o},getRules:function(){var t=[];for(var e in this.lookupTable){var o=this.lookupTable[e];o&&(l.isArray(o)?t=t.concat(o):t.push(o))}return t}},t.UrlFilterRuleLookupTable=function(){this.shortcutsLookupTable=new t.ShortcutsLookupTable,this.domainsLookupTable=new t.DomainsLookupTable,this.rulesWithoutShortcuts=[]},t.UrlFilterRuleLookupTable.prototype={addRule:function(t){this.shortcutsLookupTable.addRule(t)||this.domainsLookupTable.addRule(t)||this.rulesWithoutShortcuts.push(t)},removeRule:function(t){this.shortcutsLookupTable.removeRule(t),this.domainsLookupTable.removeRule(t),l.removeRule(this.rulesWithoutShortcuts,t)},clearRules:function(){this.shortcutsLookupTable.clearRules(),this.domainsLookupTable.clearRules(),this.rulesWithoutShortcuts=[]},getRules:function(){var t=[];return t=t.concat(this.rulesWithoutShortcuts),t=t.concat(this.shortcutsLookupTable.getRules()),t=t.concat(this.domainsLookupTable.getRules())},_isFiltered:function(t,e,o,l,u,r){return t.isPermitted(e)&&(l||!t.isGeneric())&&t.isFiltered(o,u,r)},_findRule:function(e,o,l,u,r,i){var s,n;if(t.UrlFilterRule.contentTypes[r]==t.UrlFilterRule.contentTypes.DOCUMENT)for(n=0;n<l.length;n++)if(s=l[n],(t.UrlFilterRule.contentTypes.DOCUMENT_LEVEL_EXCEPTIONS&s.permittedContentType)>0&&this._isFiltered(s,o,e,i,u,"DOCUMENT_LEVEL_EXCEPTIONS"))return s;for(n=0;n<l.length;n++)if(s=l[n],this._isFiltered(s,o,e,i,u,r))return s;return null},findRule:function(t,e,o,l,u){if(!t)return null;var r,i=t.toLowerCase(),s=this.shortcutsLookupTable.lookupRules(i);return s&&s.length>0&&(r=this._findRule(t,e,s,o,l,u))?r:(s=this.domainsLookupTable.lookupRules(e),s&&s.length>0&&(r=this._findRule(t,e,s,o,l,u))?r:this.rulesWithoutShortcuts.length>0&&(r=this._findRule(t,e,this.rulesWithoutShortcuts,o,l,u))?r:null)}}}(yiclearAPI,vAPI);