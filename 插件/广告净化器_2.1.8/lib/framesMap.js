!function(e,t){"use strict";e.FramesMap=function(i,r){function a(e,t){var i=o.get(e);if(i){if(t in i)return i[t];if(t!=-1)return i[0]}return null}var l=e.PageStatistic,n=t.FilterUtils,s=t.RequestTypes,u=t.UrlUtils,c=e.whiteListService,o=new r,d=new l(this);this.recordFrame=function(e,t,i,r){var a=o.get(e),l="";if(r==s.DOCUMENT&&a){var n=a[t];n&&(l=n.url)}return a&&r!=s.DOCUMENT||o.set(e,a=Object.create(null)),a[t]={url:i,domainName:u.getDomainName(i),previousUrl:l},r==s.DOCUMENT&&(a[t].timeAdded=Date.now(),this.reloadFrameData(e)),a[t]},this.removeFrame=function(e){o.remove(e)},this.getMainFrame=function(e){return a(e,0)},this.getFrameUrl=function(e,t){var i=a(e,t);return i?i.url:null},this.getFrameDomain=function(e){var t=a(e,0);return t?t.domainName:null},this.isTabWhiteListed=function(e){var t=this.getMainFrame(e);return t&&t.frameWhiteListRule},this.isTabWhiteListedForSafebrowsing=function(e){var t=this.getMainFrame(e);return t&&t.frameWhiteListRule&&c.isDefaultMode()},this.isTabProtectionDisabled=function(e){var t=this.getMainFrame(e);return t&&t.applicationFilteringDisabled},this.isTabyiclearDetected=function(e){var t=this.getMainFrame(e);return t&&t.yiclearDetected},this.isTabyiclearWhiteListed=function(e){var t=this.getMainFrame(e);return t&&t.yiclearDetected&&t.yiclearDocumentWhiteListed},this.getTabyiclearUserWhiteListRule=function(e){var t=this.getMainFrame(e);return t&&t.yiclearDetected&&t.yiclearUserWhiteListed?t.yiclearWhiteListRule:null},this.recordYiclearIntegrationForTab=function(e,t,i,r,a,l,n){var s=this.getMainFrame(e);s&&(s.yiclearDetected=t,s.yiclearDocumentWhiteListed=i,s.yiclearUserWhiteListed=r,s.yiclearWhiteListRule=a,s.yiclearProductName=l,s.yiclearRemoveRuleNotSupported=n)},this.getFrameWhiteListRule=function(e){var t=this.getMainFrame(e);return t?t.frameWhiteListRule:null},this.reloadFrameData=function(e){var t=this.getMainFrame(e);if(t){var r=t.url,a=i.getRequestFilter().findWhiteListRule(r,r,s.DOCUMENT);a||(a=c.findWhiteListRule(r)),t.frameWhiteListRule=a,t.applicationFilteringDisabled=i.isApplicationFilteringDisabled()}},this.recordFrameReferrerHeader=function(t,r){var a=this.getMainFrame(t);if(a&&(a.referrerUrl=r),e.userSettings.Developer()||!e.compress){var l=a.url,n=i.getRequestFilter().findRuleForRequest(l,r,"RELOAD");if(null!=n&&null!=n.ReloadUrls){var s=l.replace(n.urlRegExp,n.ReloadUrls);t.reload(s)}}},this.getFrameInfo=function(e){var t=this.getMainFrame(e),i=e.url;!i&&t&&(i=t.url);var r,a,l=!u.isHttpRequest(i),s=!1,c=!1,o=!1;if(!l)if(t&&t.yiclearDetected)s=t.yiclearDocumentWhiteListed,c=t.yiclearUserWhiteListed,o=!(t.yiclearRemoveRuleNotSupported||s&&!c),r=!1,t.yiclearWhiteListRule&&(a={filterId:AntiBannerFiltersId.WHITE_LIST_FILTER_ID,ruleText:t.yiclearWhiteListRule.ruleText});else{r=t&&t.applicationFilteringDisabled;var h=t?t.frameWhiteListRule:null;s=null!=h,s&&(c=n.isWhiteListFilterRule(h)||n.isUserFilterRule(h)),o=!(s&&!c),h&&(a={filterId:h.filterId,ruleText:h.ruleText})}var f=t?t.blocked:0,m=d.getTotalBlocked();return{url:i,applicationFilteringDisabled:r,urlFilteringDisabled:l,documentWhiteListed:s,userWhiteListed:c,canAddRemoveRule:o,frameRule:a,yiclearDetected:t&&t.yiclearDetected,yiclearProductName:t?t.yiclearProductName:null,totalBlockedTab:f||0,totalBlocked:m||0}},this.updateBlockedAdsCount=function(e,t){var i=this.getMainFrame(e);return i?(i.blocked=(i.blocked||0)+t,d.updateTotalBlocked(t),i.blocked):null},this.resetBlockedAdsCount=function(e){if(e){var t=this.getMainFrame(e);t&&(t.blocked=0)}else d.resetStats()},this.getBlockedCount=function(){return d.getTotalBlocked()},this.checkTabIncognitoMode=function(e){o.checkIncognitoMode(e)},this.isIncognitoTab=function(e){return o.isIncognito(e)}}}(yiclearAPI,vAPI);