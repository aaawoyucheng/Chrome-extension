!function(e,t){e.RequestFilter=function(){this.urlBlockingFilter=new e.urlFilter,this.urlWhiteFilter=new e.urlFilter,this.cssFilter=new e.CssFilter,this.scriptFilter=new e.ScriptFilter,this.rulesCount=0,this.requestCache=Object.create(null),this.requestCacheSize=0},e.RequestFilter.prototype={requestCacheMaxSize:1e3,addRules:function(e){if(e)for(var t=0;t<e.length;t++)this.addRule(e[t])},addRule:function(t){null!==t&&t.ruleText&&(t instanceof e.UrlFilterRule?t.whiteListRule?this.urlWhiteFilter.addRule(t):this.urlBlockingFilter.addRule(t):t instanceof e.CssFilterRule?this.cssFilter.addRule(t):t instanceof e.ScriptFilterRule&&this.scriptFilter.addRule(t),this.rulesCount++,this._clearRequestCache())},removeRule:function(t){null!==t&&(t instanceof e.UrlFilterRule?t.whiteListRule?this.urlWhiteFilter.removeRule(t):this.urlBlockingFilter.removeRule(t):t instanceof e.CssFilterRule?this.cssFilter.removeRule(t):t instanceof e.ScriptFilterRule&&this.scriptFilter.removeRule(t),this.rulesCount--,this._clearRequestCache())},getRules:function(){var e=[];return e=e.concat(this.urlWhiteFilter.getRules()),e=e.concat(this.urlBlockingFilter.getRules()),e=e.concat(this.cssFilter.getRules()),e=e.concat(this.scriptFilter.getRules())},getSelectorsForUrl:function(i,s){var r=t.UrlUtils.getDomainName(i);if(e.userSettings.collectHitsCount()){var l=this.cssFilter.buildCssHits(r,s);return l.cssHitsCounterEnabled=!0,l}return this.cssFilter.buildCss(r,s)},getInjectedSelectorsForUrl:function(e,i){var s=t.UrlUtils.getDomainName(e);return this.cssFilter.buildInjectCss(s,i)},getScriptsForUrl:function(e){var i=t.UrlUtils.toPunyCode(t.UrlUtils.getDomainName(e));return this.scriptFilter.buildScript(i)},clearRules:function(){this.urlWhiteFilter.clearRules(),this.urlBlockingFilter.clearRules(),this.cssFilter.clearRules(),this._clearRequestCache()},findWhiteListRule:function(e,i,s){var r=t.UrlUtils.getHost(i),l=t.UrlUtils.isThirdPartyRequest(e,i),u=this._searchRequestCache(e,r,s);if(u)return u[0];var c=this._checkWhiteList(e,r,s,l);return this._saveResultToCache(e,c,r,s),c},findRuleForRequest:function(e,i,s,r){var l=t.UrlUtils.getHost(i),u=t.UrlUtils.isThirdPartyRequest(e,i),c=this._searchRequestCache(e,l,s);if(c)return c[0];var n=this._findRuleForRequest(e,l,s,u,r);return this._saveResultToCache(e,n,l,s),n},_checkWhiteList:function(e,i,s,r){return null===this.urlWhiteFilter||t.StringUtils.isEmpty(e)?null:this.urlWhiteFilter.isFiltered(e,i,s,r)},_checkUrlBlockingList:function(e,i,s,r,l){return null===this.urlBlockingFilter||t.StringUtils.isEmpty(e)?null:this.urlBlockingFilter.isFiltered(e,i,s,r,!l)},_findRuleForRequest:function(e,t,i,s,r){var l=this._checkWhiteList(e,t,i,s),u=!r||!r.checkContentType("GENERICBLOCK"),c=!r||!r.checkContentType("URLBLOCK"),n=this._checkUrlBlockingList(e,t,i,s,u);return!l||!l.isImportant&&n&&n.isImportant?c?n:r:l},_searchRequestCache:function(e,t,i){var s=this.requestCache[e];return s&&s[1]===t&&s[2]===i?s:null},_saveResultToCache:function(e,t,i,s){this.requestCacheSize>this.requestCacheMaxSize&&this._clearRequestCache(),this.requestCache[e]=[t,i,s],this.requestCacheSize++},_clearRequestCache:function(){0!==this.requestCacheSize&&(this.requestCache=Object.create(null),this.requestCacheSize=0)}}}(yiclearAPI,vAPI);